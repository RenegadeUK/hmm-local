import{c as n,a as N,j as e,o as m,$ as A,A as h,T as q}from"./index-Dd-CIDLG-1771272486634.js";import{L as S}from"./layers-u5DmFx5e-1771272486634.js";import{Z as M}from"./zap-DlohDK7--1771272486634.js";import{S as H}from"./shield-alert-BXMXKNwZ-1771272486634.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=n("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=n("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=n("ServerCog",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M4.5 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-.5",key:"tn8das"}],["path",{d:"M4.5 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-.5",key:"1g2pve"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m15.7 13.4-.9-.3",key:"1jwmzr"}],["path",{d:"m9.2 10.9-.9-.3",key:"qapnim"}],["path",{d:"m10.6 15.7.3-.9",key:"quwk0k"}],["path",{d:"m13.6 15.7-.4-1",key:"cb9xp7"}],["path",{d:"m10.8 9.3-.4-1",key:"1uaiz5"}],["path",{d:"m8.3 13.6 1-.4",key:"s6srou"}],["path",{d:"m14.7 10.8 1-.4",key:"4d31cq"}],["path",{d:"m13.4 8.3-.3.9",key:"1bm987"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=n("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);function P(){var y,j,u;const i="bg-gray-900/80 rounded-xl border border-gray-800",{data:s}=N({queryKey:["database-health"],queryFn:async()=>{const t=await fetch("/api/health/database");if(!t.ok)throw new Error("Failed to fetch database health");return t.json()},refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),{data:p,isLoading:v,isError:w}=N({queryKey:["operations-status"],queryFn:async()=>{const t=await fetch("/api/operations/status");if(!t.ok)throw new Error("Failed to load operations status");return t.json()},refetchInterval:5e3});if(v)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-blue-500"})});if(w||!p)return e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load operations status."});const{automation_rules:b,strategy:r,ha:c,telemetry:l,db_pool:d,modes:a}=p,x=({values:t,labels:_,color:f="bg-blue-500"})=>{const k=Math.max(...t,1);return e.jsx("div",{className:"flex items-end gap-2",children:t.map(($,o)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-3 rounded-full ${f}`,style:{height:`${$/k*36+6}px`}}),e.jsx("span",{className:"text-[10px] text-gray-400",children:_[o]})]},`${_[o]}-${o}`))})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-gray-800 bg-gradient-to-r from-blue-950/60 via-slate-900/80 to-gray-900/60 p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-7 w-7 text-blue-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Operations"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real-time system posture & decision trace"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${a.ramp_up?"bg-yellow-900/40 text-yellow-300 border border-yellow-700/60":"bg-emerald-900/30 text-emerald-300 border border-emerald-700/40"}`,children:a.ramp_up?"Ramp-up":"Stable"}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${a.throttling_writes?"bg-red-900/40 text-red-300 border border-red-700/60":"bg-slate-800/60 text-slate-300 border border-slate-700/40"}`,children:a.throttling_writes?"Write Throttling":"Writes OK"}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${a.ha_unstable?"bg-orange-900/40 text-orange-300 border border-orange-700/60":"bg-slate-800/60 text-slate-300 border border-slate-700/40"}`,children:a.ha_unstable?"HA Degraded":"HA Stable"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-blue-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Active automation rules"}),e.jsx(S,{className:"h-4 w-4 text-blue-400"})]}),b.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No active rules."}):e.jsx("ul",{className:"space-y-2 text-sm",children:b.map(t=>e.jsxs("li",{className:"rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("div",{className:"text-white font-semibold",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Trigger: ",t.trigger_type," • Action: ",t.action_type]})]},t.id))})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-purple-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Current strategy per miner"}),e.jsx(A,{className:"h-4 w-4 text-purple-400"})]}),r.enrolled_miners.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No miners enrolled."}):e.jsx("ul",{className:"space-y-2 text-sm",children:r.enrolled_miners.map(t=>e.jsxs("li",{className:"flex items-center justify-between rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("span",{className:"text-white",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:"Price Band Strategy"})]},t.id))})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-emerald-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Last decision"}),e.jsx(m,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"text-white",children:["Band: ",r.current_price_band??"N/A",r.current_band_sort_order!==null&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(Band ",r.current_band_sort_order,")"]})]}),r.champion_mode_enabled&&r.current_band_sort_order===5&&r.current_champion_miner_name&&e.jsxs("div",{className:"text-purple-300",children:["Champion: ",r.current_champion_miner_name]}),e.jsxs("div",{className:"text-gray-400",children:["Last action: ",r.last_action_time??"N/A"]}),e.jsxs("div",{className:"text-gray-400",children:["Last price: ",r.last_price_checked??"N/A"]})]})]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`${i} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Connection Pool"}),e.jsx(m,{className:`h-4 w-4 ${s.status==="critical"?"text-red-400":s.status==="warning"?"text-yellow-400":"text-green-400"}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-white",children:[s.pool.utilization_percent,"%"]}),e.jsx("span",{className:"text-sm text-gray-400",children:"utilized"})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${s.pool.utilization_percent>90?"bg-red-500":s.pool.utilization_percent>80?"bg-yellow-500":"bg-green-500"}`,style:{width:`${s.pool.utilization_percent}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.pool.checked_out,"/",s.pool.total_capacity," connections (",s.pool.max_capacity_configured??s.pool.total_capacity," max)"]})]})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Active Queries"}),e.jsx(M,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:((y=s.postgresql)==null?void 0:y.active_connections)||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"running queries"}),s.postgresql&&s.postgresql.long_running_queries>0&&e.jsxs("p",{className:"text-xs text-yellow-400 flex items-center space-x-1",children:[e.jsx(h,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.postgresql.long_running_queries," slow (",">","1min)"]})]})]})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Database Size"}),e.jsx(L,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[((j=s.postgresql)==null?void 0:j.database_size_mb.toFixed(1))||"0"," MB"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"total storage"})]})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Health Status"}),e.jsx(q,{className:`h-4 w-4 ${s.status==="healthy"?"text-green-400":s.status==="warning"?"text-yellow-400":"text-red-400"}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.status==="healthy"?"bg-green-900/30 text-green-400 border border-green-700":s.status==="warning"?"bg-yellow-900/30 text-yellow-400 border border-yellow-700":"bg-red-900/30 text-red-400 border border-red-700"}`,children:s.status.toUpperCase()}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[s.status==="healthy"&&"All systems operational",s.status==="warning"&&"Pool usage high",s.status==="critical"&&"Pool nearly exhausted"]})]})]})]}),s.high_water_marks&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`${i} p-4`,children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"High-water marks (last 24h)"}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:["Since ",s.high_water_marks.last_24h_date]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Pool in-use peak"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.last_24h.db_pool_in_use_peak})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Active queries peak"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.last_24h.active_queries_peak})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Wait count"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.last_24h.db_pool_wait_count})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Wait seconds"}),e.jsxs("div",{className:"text-white font-semibold",children:[s.high_water_marks.last_24h.db_pool_wait_seconds_sum.toFixed(1),"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Slow queries"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.last_24h.slow_query_count})]})]})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"High-water marks (since boot)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Pool in-use peak"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.since_boot.db_pool_in_use_peak})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Active queries peak"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.since_boot.active_queries_peak})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Wait count"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.since_boot.db_pool_wait_count})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Wait seconds"}),e.jsxs("div",{className:"text-white font-semibold",children:[s.high_water_marks.since_boot.db_pool_wait_seconds_sum.toFixed(1),"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Slow queries"}),e.jsx("div",{className:"text-white font-semibold",children:s.high_water_marks.since_boot.slow_query_count})]})]})]})]}),e.jsxs("div",{className:`${i} p-6`,children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Current Database"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"px-4 py-2 rounded-lg font-mono text-lg bg-green-900/30 text-green-400 border border-green-700",children:"POSTGRESQL"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Embedded PostgreSQL running at localhost:5432"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`rounded-xl border p-4 ${a.ramp_up?"border-yellow-700 bg-yellow-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:`h-4 w-4 ${a.ramp_up?"text-yellow-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"System ramp-up"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a.ramp_up?"Telemetry backlog detected; system may be catching up.":"Normal telemetry cadence."})]}),e.jsxs("div",{className:`rounded-xl border p-4 ${a.throttling_writes?"border-red-700 bg-red-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:`h-4 w-4 ${a.throttling_writes?"text-red-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Write throttling"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a.throttling_writes?"DB pool usage is high; writes may be constrained.":"DB pool healthy."})]}),e.jsxs("div",{className:`rounded-xl border p-4 ${a.ha_unstable?"border-orange-700 bg-orange-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:`h-4 w-4 ${a.ha_unstable?"text-orange-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"HA unstable"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:a.ha_unstable?"Home Assistant keepalive is unstable.":"Home Assistant stable."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"DB connections"}),e.jsx(g,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:d.high_water.last_24h.db_pool_in_use_peak}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • since ",d.high_water.last_24h_date]})]}),e.jsx(x,{values:[d.checked_out,d.high_water.last_24h.db_pool_in_use_peak,d.high_water.since_boot.db_pool_in_use_peak],labels:["Now","24h","Boot"],color:"bg-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Miner concurrency"}),e.jsx(g,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.metrics.last_24h.peak_concurrency}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • since ",l.metrics.last_24h_date]})]}),e.jsx(x,{values:[l.metrics.last_24h.peak_concurrency,l.metrics.since_boot.peak_concurrency],labels:["24h","Boot"],color:"bg-purple-500"})]})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Telemetry backlog"}),e.jsx(g,{className:"h-4 w-4 text-emerald-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.metrics.last_24h.max_backlog}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • current ",l.backlog_current]})]}),e.jsx(x,{values:[l.backlog_current,l.metrics.last_24h.max_backlog,l.metrics.since_boot.max_backlog],labels:["Now","24h","Boot"],color:"bg-emerald-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`${i} p-4`,children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"DB connections (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:d.high_water.since_boot.db_pool_in_use_peak})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"Miner concurrency (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:l.metrics.since_boot.peak_concurrency})]}),e.jsxs("div",{className:`${i} p-4`,children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"Telemetry backlog (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:l.metrics.since_boot.max_backlog})]})]}),((u=c.detail)==null?void 0:u.enabled)&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 text-xs text-gray-500",children:["HA last success: ",c.detail.last_success??"N/A"," · Downtime start: ",c.detail.downtime_start??"N/A"," · Alerts: ",c.detail.alerts_sent??0]})]})}export{P as default};
