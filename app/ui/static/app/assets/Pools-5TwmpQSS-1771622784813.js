import{c as B,r as o,j as e,E as Y,F as X,G as Z,H as ee,I as se,s as P,A as R,t as te,v as re,w as le,x as ne,J as ie,K as de,y as oe,O as ce,Q as ae,B as u,m as me,a as J,n as K,W as xe,U as he,o as G,C as T,f as L,d as ue,V as pe}from"./index-DgpQ0Bj4-1771622784813.js";import{I as ge}from"./info-COCOQLyg-1771622784813.js";import{L as je}from"./loader-2-D-BR9lvS-1771622784813.js";import{S as ye}from"./shield-alert-BOngTl0I-1771622784813.js";import{E as fe}from"./eye-D8JplJBX-1771622784813.js";import{T as Ne}from"./trash-2-hDSeShwp-1771622784813.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=B("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=B("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=B("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function we({open:n,mode:d,pool:a,isSubmitting:y,onOpenChange:p,onSubmit:U}){const[x,_]=o.useState(""),[f,m]=o.useState(""),[C,N]=o.useState(!0),[k,g]=o.useState(null),[D,A]=o.useState([]),[c,F]=o.useState(!0),[M,I]=o.useState(null);o.useEffect(()=>{let i=!0;return fetch("/api/pool-templates").then(r=>{if(!r.ok)throw new Error(`Failed to fetch templates: ${r.statusText}`);return r.json()}).then(r=>{i&&(console.log(`âœ… Loaded ${r.length} pool templates:`,r.map(l=>`${l.pool_display_name} ${l.coin}`)),A(r),F(!1))}).catch(r=>{i&&(I(r.message),F(!1))}),()=>{i=!1}},[]);const b=o.useMemo(()=>{const i=[],r=new Map;return D.forEach(l=>{const h=l.coin,w={key:l.template_id,name:l.display_name,url:l.url,port:l.port,group:h,subtitle:[l.pool_display_name,l.region||"Global",l.mining_model==="solo"?"Solo mining":"Pool mining"].join(" Â· ")};r.has(h)||r.set(h,[]),r.get(h).push(w)}),r.forEach((l,h)=>{i.push({label:h,options:l})}),console.log(`ðŸ“¦ Template groups (${i.length}):`,i.map(l=>`${l.label} (${l.options.length})`)),i},[D]),v=o.useMemo(()=>{const i={};return b.forEach(r=>{r.options.forEach(l=>{i[l.key]=l})}),i},[b]),j=o.useMemo(()=>x?v[x]:null,[x,v]);o.useEffect(()=>{n?(d==="edit"&&a?(m(a.user||""),N(a.enabled)):(m(""),N(!0),_("")),g(null)):(m(""),_(""),g(null))},[n,d,a]);const $=async i=>{i.preventDefault();const r=f.trim();if(d==="add"&&!x){g("Select an approved pool provider to continue.");return}if(!r){g("Wallet address / username is required.");return}let l;if(d==="add"&&(l=v[x],!l)){g("Invalid pool preset selected.");return}const h={id:a==null?void 0:a.id,name:d==="add"?l.name:(a==null?void 0:a.name)||"",url:d==="add"?l.url:(a==null?void 0:a.url)||"",port:d==="add"?l.port:(a==null?void 0:a.port)||0,user:r,password:(a==null?void 0:a.password)||"x",enabled:C,show_on_dashboard:(a==null?void 0:a.show_on_dashboard)??!0};try{await U(h),p(!1)}catch(w){g(w instanceof Error?w.message:"Failed to save pool settings.")}},H=d==="add"?"Add Mining Pool":"Edit Pool",q=d==="add"?"Select an approved provider and supply the wallet address or username you use with that pool.":"Update the wallet address / username and status for this pool. Provider settings remain locked for safety.",O=d==="edit"&&a;return e.jsx(Y,{open:n,onOpenChange:p,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsxs(ee,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-blue-400"}),H]}),e.jsx(se,{className:"text-gray-400",children:q})]}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[d==="add"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{htmlFor:"provider",children:"1ï¸âƒ£ Pool Provider"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(ge,{className:"h-4 w-4"}),c?"Loading templates...":`${D.length} templates available`]})]}),c?e.jsxs("div",{className:"flex items-center justify-center p-8 text-gray-400",children:[e.jsx(je,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading pool templates..."})]}):M?e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:[e.jsx(R,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:M})]}):e.jsxs(e.Fragment,{children:[e.jsxs(te,{value:x,onValueChange:_,children:[e.jsx(re,{id:"provider",children:e.jsx(le,{placeholder:"Choose a pool"})}),e.jsx(ne,{children:b.map(i=>e.jsxs(ie,{children:[e.jsx(de,{children:i.label}),i.options.map(r=>e.jsx(oe,{value:r.key,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:r.name}),r.subtitle&&e.jsx("span",{className:"text-xs text-gray-400",children:r.subtitle})]})},r.key))]},i.label))})]}),j&&e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900/60 p-4 text-sm",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:j.name}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[j.url,":",j.port]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"These connection details are locked to ensure reliability."})]})]})]}),O&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Pool Name"}),e.jsx("input",{type:"text",value:a.name,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"URL"}),e.jsx("input",{type:"text",value:a.url,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Port"}),e.jsx("input",{type:"text",value:a.port,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{htmlFor:"wallet",children:"2ï¸âƒ£ Wallet Address / Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"wallet",type:"text",value:f,onChange:i=>m(i.target.value),placeholder:"paste your Braiins username or Solopool wallet",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40",disabled:c}),e.jsx(V,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:'This is the only editable field per pool. Passwords default to "x" for all approved providers.'})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{id:"enabled",checked:C,onCheckedChange:i=>N(!!i)}),e.jsx(P,{htmlFor:"enabled",className:"text-sm",children:"Pool enabled"})]}),k&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:[e.jsx(R,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:k})]}),e.jsxs(ae,{className:"gap-3 sm:gap-2",children:[e.jsx(u,{type:"button",variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:y||c,className:"min-w-[140px]",children:y?"Savingâ€¦":d==="add"?"Add Pool":"Save Changes"})]})]})]})})}async function E(n,d){const a=await fetch(n,{headers:{"Content-Type":"application/json",...(d==null?void 0:d.headers)||{}},...d});if(!a.ok){const y=await a.json().catch(()=>({})),p=y.detail||y.message||`Request failed (${a.status})`;throw new Error(p)}if(a.status!==204)return a.json()}function Se(n){return typeof n!="number"?{label:"No data",className:"text-gray-400"}:n>=70?{label:"Healthy",className:"text-green-400"}:n>=40?{label:"Fair",className:"text-yellow-400"}:{label:"Critical",className:"text-red-400"}}function Q(n,d=""){return n==null?"â€”":`${n}${d}`}function Me(){const n=me(),[d,a]=o.useState("add"),[y,p]=o.useState(!1),[U,x]=o.useState(null),[_,f]=o.useState(!1),[m,C]=o.useState(null),[N,k]=o.useState(null),{data:g=[],isLoading:D,error:A}=J({queryKey:["pools"],queryFn:()=>E("/api/pools/")}),{data:c,isLoading:F,error:M}=J({queryKey:["pool-health-overview"],queryFn:()=>E("/api/pools/health/overview"),refetchInterval:6e4}),I=o.useMemo(()=>{const s=new Map;return c==null||c.pools.forEach(t=>s.set(t.pool_id,t)),s},[c]),b=K({mutationFn:s=>{const{id:t,...S}=s;return E("/api/pools/",{method:"POST",body:JSON.stringify(S)})},onSuccess:()=>{n.invalidateQueries({queryKey:["pools"]}),n.invalidateQueries({queryKey:["pool-health-overview"]})}}),v=K({mutationFn:s=>{if(!s.id)throw new Error("Pool ID missing");const{id:t,...S}=s;return E(`/api/pools/${t}`,{method:"PUT",body:JSON.stringify(S)})},onSuccess:()=>{n.invalidateQueries({queryKey:["pools"]}),n.invalidateQueries({queryKey:["pool-health-overview"]})}}),j=K({mutationFn:s=>E(`/api/pools/${s}`,{method:"DELETE"}),onSuccess:()=>{n.invalidateQueries({queryKey:["pools"]}),n.invalidateQueries({queryKey:["pool-health-overview"]})}}),$=K({mutationFn:({poolId:s,show:t})=>E(`/api/pools/${s}`,{method:"PUT",body:JSON.stringify({show_on_dashboard:t})}),onSuccess:()=>{n.invalidateQueries({queryKey:["pools"]}),n.invalidateQueries({queryKey:["dashboard"]})}}),H=b.isPending||v.isPending,q=o.useMemo(()=>[...g].sort((s,t)=>s.name.toLowerCase().localeCompare(t.name.toLowerCase())),[g]),O=()=>{a("add"),x(null),p(!0)},i=s=>{a("edit"),x(s),p(!0)},r=async s=>{d==="add"?await b.mutateAsync(s):await v.mutateAsync(s)},l=s=>{C(s),k(null),f(!0)},h=async()=>{if(m)try{await j.mutateAsync(m.id),f(!1),C(null)}catch(s){k(s instanceof Error?s.message:"Unable to delete pool")}},w=async s=>{await $.mutateAsync({poolId:s.id,show:!s.show_on_dashboard})},W=A instanceof Error?A.message:null,z=M instanceof Error?M.message:null;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{children:"Pools"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Pool Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review pool health, manage approved providers, and keep Braiins Pool telemetry in sync."}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",children:[e.jsxs(u,{onClick:O,className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Add Pool"]}),e.jsxs(u,{variant:"outline",onClick:()=>n.invalidateQueries({queryKey:["pool-health-overview"]}),className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Refresh Health"]})]})]}),c&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(T,{children:e.jsxs(L,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Pools"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:c.total_pools})]})}),e.jsx(T,{children:e.jsxs(L,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Healthy"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-2",children:[e.jsx("p",{className:"text-2xl font-semibold text-green-400",children:c.healthy_pools}),e.jsxs("span",{className:"text-sm text-gray-500",children:["/",c.total_pools]})]})]})}),e.jsx(T,{children:e.jsxs(L,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Response Time"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:Q(c.avg_response_time_ms,"ms")})]})}),e.jsx(T,{children:e.jsxs(L,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Reject Rate"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:Q(c.avg_reject_rate,"%")})]})})]}),(W||z)&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:W||z})]}),e.jsxs(T,{children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configured Pools"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Only approved Solopool and Braiins providers are shown."})]})}),e.jsx(L,{children:D||F?e.jsx("div",{className:"flex min-h-[200px] items-center justify-center text-gray-400",children:"Loading poolsâ€¦"}):q.length===0?e.jsxs("div",{className:"rounded-md border border-dashed border-gray-700 p-8 text-center",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:"No pools configured yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Use the Add Pool button to connect your preferred provider."}),e.jsx(u,{onClick:O,className:"mt-4",children:"Add Pool"})]}):e.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:q.map(s=>{const t=I.get(s.id),S=Se(t==null?void 0:t.health_score);return e.jsxs("div",{className:"rounded-xl border border-gray-800 bg-gray-950/60 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold",children:s.name}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${s.enabled?"bg-green-500/10 text-green-300":"bg-gray-600/20 text-gray-400"}`,children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.url,":",s.port]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Worker: ",s.user]})]}),e.jsx("div",{className:`text-sm font-medium ${S.className}`,children:S.label})]}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Health Score"}),e.jsx("p",{className:"text-lg font-semibold",children:(t==null?void 0:t.health_score)??"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Response"}),e.jsx("p",{className:"text-lg font-semibold",children:Q(t==null?void 0:t.response_time_ms,"ms")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Reject Rate"}),e.jsx("p",{className:"text-lg font-semibold",children:Q(t==null?void 0:t.reject_rate,"%")})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Active miners: ",(t==null?void 0:t.active_miners)??0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),t!=null&&t.last_checked?new Date(t.last_checked).toLocaleTimeString():"No checks yet"]}),(t==null?void 0:t.error_message)&&e.jsxs("div",{className:"flex items-center gap-1 text-red-300",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),t.error_message]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[e.jsxs(u,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:()=>w(s),disabled:$.isPending,children:[s.show_on_dashboard?e.jsx(fe,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"}),s.show_on_dashboard?"Hide from Dashboard":"Show on Dashboard"]}),e.jsxs(u,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:()=>i(s),children:[e.jsx(ve,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(u,{variant:"destructive",size:"sm",className:"flex items-center gap-2",onClick:()=>l(s),disabled:j.isPending&&(m==null?void 0:m.id)===s.id,children:[e.jsx(Ne,{className:"h-4 w-4"}),"Delete"]})]})]},s.id)})})})]}),e.jsx(we,{open:y,mode:d,pool:U,isSubmitting:H,onOpenChange:s=>{p(s),s||(x(null),a("add"))},onSubmit:r}),e.jsx(Y,{open:_,onOpenChange:f,children:e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx(ee,{className:"text-lg font-semibold",children:"Delete pool"}),e.jsx(se,{children:"This action removes the pool from every miner and automation rule. You can re-add it later using the approved presets."})]}),e.jsx("p",{className:"text-sm text-gray-300",children:m?`${m.name} (${m.url}:${m.port})`:""}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-300",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:N})]}),e.jsxs(ae,{className:"gap-3",children:[e.jsx(u,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(u,{variant:"destructive",onClick:h,disabled:j.isPending,children:j.isPending?"Deletingâ€¦":"Delete Pool"})]})]})})]})}export{Me as default};
