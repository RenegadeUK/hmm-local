import{m as xs,r as b,a as D,n as J,j as e,o as Xe,W as Ge,C as S,d as F,e as M,f as L,L as ms,R as us,T as hs,a1 as T,a2 as He}from"./index-DgpQ0Bj4-1771622784813.js";import{C as bs}from"./check-circle-2-D36cZTJb-1771622784813.js";import{A as ps}from"./alert-triangle-BMeZCrWQ-1771622784813.js";import{Z as gs}from"./zap-sN6YK_3B-1771622784813.js";import{H as js}from"./hard-drive-CwqQnTxn-1771622784813.js";const es="hmm_local_stratum";function Ns(r){return typeof r!="number"||!Number.isFinite(r)?"N/A":`${r.toFixed(2)}%`}function n(r){return typeof r!="number"||!Number.isFinite(r)?"N/A":new Intl.NumberFormat().format(r)}function fs(r){return typeof r!="number"||!Number.isFinite(r)?"N/A":r>=1024?`${(r/1024).toFixed(2)} GB`:`${r.toFixed(1)} MB`}function ss(r){if(!r)return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const h=new Date(r).getTime();if(Number.isNaN(h))return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const k=Math.max(0,Math.floor((Date.now()-h)/1e3));return k<=60?{label:"Fresh",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}:k<=180?{label:"Aging",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Stale",className:"border-red-700/60 bg-red-900/30 text-red-300"}}function vs(r){return typeof r!="number"||!Number.isFinite(r)?{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"}:r>=5?{label:"High",className:"border-red-700/60 bg-red-900/30 text-red-300"}:r>=3?{label:"Elevated",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Normal",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}}function P(r){if(!r)return"Unknown";const h=new Date(r).getTime();if(Number.isNaN(h))return r;const k=Math.max(0,Math.floor((Date.now()-h)/1e3));if(k<60)return`${k}s ago`;const v=Math.floor(k/60);if(v<60)return`${v}m ago`;const A=Math.floor(v/60);return A<24?`${A}h ago`:`${Math.floor(A/24)}d ago`}function _s(r){if(!r)return"Unknown";const h=new Date(r);return Number.isNaN(h.getTime())?r:h.toISOString().replace("T"," ").replace(".000Z","Z")}function ts(r,h=8){return r?r.length<=h*2+3?r:`${r.slice(0,h)}...${r.slice(-h)}`:"N/A"}function ys(r){if(r.accepted_by_node)return{label:"Accepted",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"};const h=String(r.reject_category||"").toLowerCase();return h.includes("invalid")||h.includes("bad")||h.includes("rpc_error")?{label:"Rejected",className:"border-red-700/60 bg-red-900/30 text-red-300"}:{label:"Inconclusive",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}}function Ls(){var le,re,ne,ie,de,ce,oe,xe,me,ue,he,be,pe,ge;const r=xs(),[h,k]=b.useState(!1),[v,A]=b.useState(!1),[W,K]=b.useState(null),[Y,X]=b.useState(!0),[G,H]=b.useState(!0),[R,ee]=b.useState(!1),[O,se]=b.useState(!0),[te,ae]=b.useState(5),[U,N]=b.useState(null),c=D({queryKey:["integrations","hmm-local-stratum","settings"],queryFn:()=>T.getHmmLocalStratumSettings(),staleTime:3e4});b.useEffect(()=>{var s,i,x,o,l,t,a,m,f;typeof((s=c.data)==null?void 0:s.enabled)=="boolean"&&k(c.data.enabled),typeof((i=c.data)==null?void 0:i.failover_enabled)=="boolean"&&A(c.data.failover_enabled),((x=c.data)==null?void 0:x.backup_pool_id)===null||((o=c.data)==null?void 0:o.backup_pool_id)===void 0?K(null):K(Number(c.data.backup_pool_id)),typeof((l=c.data)==null?void 0:l.local_stratum_enabled)=="boolean"&&X(c.data.local_stratum_enabled),typeof((t=c.data)==null?void 0:t.hard_lock_enabled)=="boolean"&&H(c.data.hard_lock_enabled),typeof((a=c.data)==null?void 0:a.hard_lock_active)=="boolean"&&ee(c.data.hard_lock_active),typeof((m=c.data)==null?void 0:m.auto_return_enabled)=="boolean"&&se(c.data.auto_return_enabled),typeof((f=c.data)==null?void 0:f.auto_return_minutes)=="number"&&ae(Math.max(1,c.data.auto_return_minutes))},[c.data]);const j=J({mutationFn:()=>T.saveHmmLocalStratumSettings({enabled:h,failover_enabled:v,backup_pool_id:W,local_stratum_enabled:Y,hard_lock_enabled:G,hard_lock_active:R,auto_return_enabled:O,auto_return_minutes:te}),onSuccess:s=>{N({tone:"success",message:s.message||"Settings saved"}),r.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),r.invalidateQueries({queryKey:["layout","stratum-dashboards-enabled"]}),setTimeout(()=>N(null),3500)},onError:s=>{N({tone:"error",message:s.message||"Failed to save settings"}),setTimeout(()=>N(null),3500)}}),I=J({mutationFn:()=>T.blockHmmLocalStratumGuard({reason:"manual_force_failover_from_hmm_local_settings"}),onSuccess:s=>{const i=Math.max(0,s.count-s.ok_count),x=i>0?`Force block sent to ${s.ok_count}/${s.count} pool(s)`:`Force block sent to ${s.ok_count} pool(s)`;N({tone:i>0?"error":"success",message:x}),r.invalidateQueries({queryKey:["integrations","hmm-local-stratum","operational"]}),r.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),setTimeout(()=>N(null),4e3)},onError:s=>{N({tone:"error",message:s.message||"Failed to force block guard"}),setTimeout(()=>N(null),4e3)}}),Q=J({mutationFn:()=>T.unblockHmmLocalStratumGuard({}),onSuccess:s=>{const i=Math.max(0,s.count-s.ok_count),x=i>0?`Unblock sent to ${s.ok_count}/${s.count} pool(s)`:`Unblock sent to ${s.ok_count} pool(s)`;N({tone:i>0?"error":"success",message:x}),r.invalidateQueries({queryKey:["integrations","hmm-local-stratum","operational"]}),r.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),setTimeout(()=>N(null),4e3)},onError:s=>{N({tone:"error",message:s.message||"Failed to unblock guard"}),setTimeout(()=>N(null),4e3)}}),C=D({queryKey:["integrations","hmm-local-stratum","tiles"],queryFn:()=>He.getPoolTiles(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),$=D({queryKey:["integrations","hmm-local-stratum","recovery-status"],queryFn:()=>He.getRecoveryStatus(24),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),w=D({queryKey:["integrations","hmm-local-stratum","operational"],queryFn:()=>T.getHmmLocalStratumOperational(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),_=D({queryKey:["integrations","hmm-local-stratum","candidate-incidents"],queryFn:()=>T.getHmmLocalStratumCandidateIncidents(24,50),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),y=b.useMemo(()=>Object.values(C.data||{}).filter(s=>s.pool_type===es),[C.data]),as=b.useMemo(()=>Object.values(C.data||{}).filter(s=>s.pool_type!==es).sort((s,i)=>s.display_name.localeCompare(i.display_name)),[C.data]),B=b.useMemo(()=>{var i;const s=new Map;for(const x of((i=$.data)==null?void 0:i.pools)||[])s.set(String(x.pool_id),x);return s},[(le=$.data)==null?void 0:le.pools]),ls=b.useMemo(()=>{var i;const s=new Map;for(const x of((i=$.data)==null?void 0:i.pools)||[]){const o=String(x.pool_name||"").trim().toLowerCase();o&&s.set(o,x)}return s},[(re=$.data)==null?void 0:re.pools]),rs=b.useMemo(()=>{var i,x,o;const s=new Map;for(const l of((i=w.data)==null?void 0:i.pools)||[])((x=l.pool)==null?void 0:x.id)!==null&&((o=l.pool)==null?void 0:o.id)!==void 0&&s.set(String(l.pool.id),l);return s},[(ne=w.data)==null?void 0:ne.pools]),ns=b.useMemo(()=>{var i,x;const s=new Map;for(const o of((i=w.data)==null?void 0:i.pools)||[]){const l=String(((x=o.pool)==null?void 0:x.name)||"").trim().toLowerCase();l&&s.set(l,o)}return s},[(ie=w.data)==null?void 0:ie.pools]),E=b.useMemo(()=>{const s=y.filter(l=>l.tile_1_health.health_status===!1).length,i=y.reduce((l,t)=>{const a=B.get(String(t.pool_id));return l.recovered+=(a==null?void 0:a.recovered_count)||0,l.unresolved+=(a==null?void 0:a.unresolved_count)||0,l},{recovered:0,unresolved:0}),x=y.filter(l=>ss(l.last_updated).label==="Stale").length,o=y.reduce((l,t)=>{var a;return l+(((a=t.warnings)==null?void 0:a.length)||0)},0);return{unhealthyPools:s,staleFeeds:x,driverWarnings:o,recovered:i.recovered,unresolved:i.unresolved}},[B,y]);return C.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Xe,{className:"h-8 w-8 animate-spin text-blue-500"})}):C.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Ge,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load Stratum operational data."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Ge,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Dedicated operational status view for local Stratum integration pools."})]}),U&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${U.tone==="success"?"border-emerald-700/60 bg-emerald-900/30 text-emerald-200":U.tone==="error"?"border-red-700/60 bg-red-900/30 text-red-200":"border-blue-700/60 bg-blue-900/30 text-blue-200"}`,children:U.message}),e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(M,{children:"HMM-Local Stratum dashboards"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:h,onChange:s=>k(s.target.checked),disabled:c.isLoading||j.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable dedicated HMM-Local Stratum dashboards"}),e.jsx("div",{className:"text-xs text-slate-400",children:"When enabled, a new top-level navigation section appears with BTC, BCH and DGB pages focused on mining pool data."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:v,onChange:s=>A(s.target.checked),disabled:c.isLoading||j.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable strategy backup-pool failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Strategy-managed miners fail over to a backup pool when local stratum is marked unavailable."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Backup pool"}),e.jsxs("select",{className:"mt-2 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100",value:W??"",onChange:s=>{const i=s.target.value;K(i?Number(i):null)},disabled:c.isLoading||j.isPending||!v,children:[e.jsx("option",{value:"",children:"Select backup pool"}),as.map(s=>e.jsx("option",{value:s.pool_id,children:s.display_name},s.pool_id))]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:Y,onChange:s=>X(s.target.checked),disabled:c.isLoading||j.isPending||!v}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Local stratum currently available"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Disable this to route strategy miners to backup pool."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:G,onChange:s=>H(s.target.checked),disabled:c.isLoading||j.isPending||!v}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable hard-lock on failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Keep miners on backup until you clear hard-lock manually."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:O,onChange:s=>se(s.target.checked),disabled:c.isLoading||j.isPending||!v}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable automatic return"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Clear hard-lock and return to primary after local stratum stays healthy."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Auto-return healthy window (minutes)"}),e.jsx("input",{type:"number",min:1,className:"mt-2 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100",value:te,onChange:s=>ae(Math.max(1,Number(s.target.value)||1)),disabled:c.isLoading||j.isPending||!v||!O})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-200",children:"Hard-lock status"}),e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${R?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-emerald-700/60 bg-emerald-900/30 text-emerald-300"}`,children:R?"Active":"Inactive"})]}),R&&e.jsx("button",{type:"button",className:"mt-3 inline-flex items-center rounded-md border border-amber-700/60 bg-amber-900/30 px-3 py-2 text-xs text-amber-200 hover:bg-amber-900/40 disabled:opacity-50",onClick:()=>ee(!1),disabled:c.isLoading||j.isPending,children:"Resume primary (clear hard-lock)"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-red-700/60 bg-red-900/30 px-3 py-2 text-xs text-red-200 hover:bg-red-900/40 disabled:opacity-50",onClick:()=>I.mutate(),disabled:c.isLoading||j.isPending||I.isPending||Q.isPending,children:I.isPending?"Forcing failover…":"Force failover (block guard)"}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-slate-600/70 bg-slate-800/40 px-3 py-2 text-xs text-slate-200 hover:bg-slate-800/60 disabled:opacity-50",onClick:()=>Q.mutate(),disabled:c.isLoading||j.isPending||I.isPending||Q.isPending,children:Q.isPending?"Unblocking…":"Manual unblock guard"})]})]}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-blue-700/60 bg-blue-900/30 px-3 py-2 text-sm text-blue-200 hover:bg-blue-900/40 disabled:opacity-50",onClick:()=>j.mutate(),disabled:j.isPending||c.isLoading,children:j.isPending?"Saving…":"Save setting"})]})]}),y.length===0?e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(M,{children:"No HMM-Local Stratum pool configured"})}),e.jsxs(L,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Add or update a pool with driver ",e.jsx("span",{className:"font-semibold text-foreground",children:"hmm_local_stratum"})," to populate this page."]}),e.jsx("div",{children:e.jsx(ms,{className:"text-blue-400 hover:text-blue-300 underline",to:"/pools",children:"Go to Pools"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(S,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm text-muted-foreground",children:"Configured pools"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:y.length}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[E.unhealthyPools," degraded"]})]})]}),e.jsxs(S,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm text-muted-foreground",children:"Data freshness risk"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:E.staleFeeds}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Stale feeds (> 3m old)"})]})]}),e.jsxs(S,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm text-muted-foreground",children:"Driver warnings"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:E.driverWarnings}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Unresolved / not-loaded flags"})]})]}),e.jsxs(S,{children:[e.jsx(F,{className:"pb-2",children:e.jsx(M,{className:"text-sm text-muted-foreground",children:"Driver recoveries (24h)"})}),e.jsxs(L,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:E.recovered}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[E.unresolved," unresolved"]})]})]})]}),e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(M,{children:"Candidate incidents (24h)"})}),e.jsx(L,{className:"space-y-4",children:_.isLoading?e.jsx("div",{className:"text-sm text-slate-300",children:"Loading candidate incidents…"}):_.isError?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-sm text-amber-300",children:["Failed to load candidate incidents: ",((de=_.error)==null?void 0:de.message)||"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Accepted: ",((ce=_.data)==null?void 0:ce.summary.accepted)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rejected: ",((oe=_.data)==null?void 0:oe.summary.rejected)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rows: ",((xe=_.data)==null?void 0:xe.count)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-400",children:["Updated ",P(((me=_.data)==null?void 0:me.fetched_at)||null)]})]}),(((he=(ue=_.data)==null?void 0:ue.fetch_errors)==null?void 0:he.length)||0)>0&&e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:"Some Stratum endpoints were unavailable. Showing partial results."}),(((pe=(be=_.data)==null?void 0:be.rows)==null?void 0:pe.length)||0)===0?e.jsx("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 text-sm text-slate-300",children:"No candidate incidents in the last 24 hours."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700/60",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-slate-900/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-medium",children:"Time (UTC)"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Coin"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Worker"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Job"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Template"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Block"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Result"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Category"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Latency"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Variant"})]})}),e.jsx("tbody",{children:(((ge=_.data)==null?void 0:ge.rows)||[]).map(s=>{const i=ys(s);return e.jsxs("tr",{className:"border-t border-slate-800/70 text-slate-200",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:_s(s.ts)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.coin||"N/A"}),e.jsx("td",{className:"px-3 py-2",title:s.worker||"",children:ts(s.worker,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.job_id||"N/A"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.template_height??"N/A"}),e.jsx("td",{className:"px-3 py-2",title:s.block_hash||"",children:ts(s.block_hash,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 ${i.className}`,children:i.label})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.reject_category||"accepted"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:typeof s.latency_ms=="number"?`${s.latency_ms.toFixed(2)} ms`:"N/A"}),e.jsx("td",{className:"px-3 py-2",title:s.matched_variant||"",children:s.matched_variant||"N/A"})]},`${s.ts}-${s.coin}-${s.job_id||"no-job"}`)})})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:y.map(s=>{var Me,Le,Ae,Ce,$e,qe,Te,Pe,Ee,De,Re,Ue,Ie,Qe,We,Ke,Oe,Be,ze,Ze,Ve,Je;const i=String(s.pool_id||"").trim(),x=String(s.display_name||"").trim().toLowerCase(),o=(i?B.get(i):void 0)||ls.get(x)||(y.length===1&&(((Le=(Me=$.data)==null?void 0:Me.pools)==null?void 0:Le.length)||0)===1?(Ce=(Ae=$.data)==null?void 0:Ae.pools)==null?void 0:Ce[0]:void 0),l=(i?rs.get(i):void 0)||ns.get(x)||(y.length===1&&(((qe=($e=w.data)==null?void 0:$e.pools)==null?void 0:qe.length)||0)===1?(Pe=(Te=w.data)==null?void 0:Te.pools)==null?void 0:Pe[0]:void 0),t=(Ee=l==null?void 0:l.stats)==null?void 0:Ee.datastore,a=l==null?void 0:l.database,m=a==null?void 0:a.pool,f=a==null?void 0:a.postgresql,p=(De=a==null?void 0:a.high_water_marks)==null?void 0:De.last_24h,g=(Re=a==null?void 0:a.high_water_marks)==null?void 0:Re.since_boot,z=Math.max(0,Math.min(100,Number((m==null?void 0:m.utilization_percent)||0))),q=String(s.tile_4_blocks.currency||"").toUpperCase(),d=q?(Ie=(Ue=l==null?void 0:l.stats)==null?void 0:Ue.coins)==null?void 0:Ie[q]:void 0,u=(Qe=l==null?void 0:l.stats)==null?void 0:Qe.dgb_proposal_guard,Z=Number((u==null?void 0:u.required_consecutive_passes)||25e3),je=Number((u==null?void 0:u.consecutive_passes)||0),Ne=Z>0?Math.max(0,Math.min(100,je/Z*100)):0,V=!!(u!=null&&u.submit_enabled),fe=Number((t==null?void 0:t.total_write_batches_ok)||0),is=Number((t==null?void 0:t.total_write_batches_failed)||0),ve=fe+is,_e=ve>0?fe/ve*100:null,ye=Number((d==null?void 0:d.shares_accepted)||0),ds=Number((d==null?void 0:d.shares_rejected)||0),ke=ye+ds,we=ke>0?ye/ke*100:null,cs=Number((d==null?void 0:d.block_candidates)||0),os=Number((d==null?void 0:d.blocks_rejected)||0),Se=ss(s.last_updated),Fe=vs(s.tile_3_shares.reject_rate);return e.jsxs(S,{children:[e.jsxs(F,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(M,{className:"text-lg",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/60 px-2 py-1 text-slate-300",children:[e.jsx(us,{className:"h-3 w-3"})," Updated ",P(s.last_updated)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-1 ${Se.className}`,children:["Feed ",Se.label]}),s.tile_1_health.health_status?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(bs,{className:"h-3 w-3"})," Healthy"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-amber-300",children:[e.jsx(ps,{className:"h-3 w-3"})," Degraded"]})]})]}),(s.warnings||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(s.warnings||[]).map(Ye=>e.jsx("span",{className:"inline-flex rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-xs text-amber-300",children:Ye},`${s.pool_id}-${Ye}`))})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Service health"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:s.tile_1_health.health_message||"No message"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Latency: ",s.tile_1_health.latency_ms??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Operational info (/stats)"}),w.isLoading?e.jsx("div",{className:"mt-1 text-sm text-slate-300",children:"Loading operational stats…"}):w.isError?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:((We=w.error)==null?void 0:We.message)||"Operational query failed"})]}):(l==null?void 0:l.status)!=="ok"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:(l==null?void 0:l.error)||"No response from Stratum API"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Queue: ",n(t==null?void 0:t.queue_depth)," / max seen ",n(t==null?void 0:t.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Rows written: ",n(t==null?void 0:t.total_rows_written)," · Dropped: ",n(t==null?void 0:t.total_dropped)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Batches ok/fail: ",n(t==null?void 0:t.total_write_batches_ok)," / ",n(t==null?void 0:t.total_write_batches_failed)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Enqueued: ",n(t==null?void 0:t.total_enqueued)," · Spooled/Replayed: ",n(t==null?void 0:t.total_spooled_rows)," / ",n(t==null?void 0:t.total_replayed_rows)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retries: ",n(t==null?void 0:t.total_retries)," · Consecutive failures: ",n(t==null?void 0:t.consecutive_write_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last write: ",P((t==null?void 0:t.last_write_ok_at)||null)," · Latency: ",((Ke=t==null?void 0:t.last_write_latency_ms)==null?void 0:Ke.toFixed(2))??"N/A"," ms"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["DB: ",(Oe=l.stats)!=null&&Oe.db_enabled?"enabled":"disabled"," · Datastore: ",t!=null&&t.enabled?"enabled":"disabled"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retention (d): H ",n(t==null?void 0:t.hashrate_retention_days)," · N ",n(t==null?void 0:t.network_retention_days)," · K ",n(t==null?void 0:t.kpi_retention_days)]}),(t==null?void 0:t.spool_path)&&e.jsxs("div",{className:"truncate text-xs text-slate-500",title:t.spool_path,children:["Spool path: ",t.spool_path]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Quality / reliability"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${Fe.className}`,children:["Reject risk: ",Fe.label]})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Reject rate: ",Ns(s.tile_3_shares.reject_rate)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid ",s.tile_3_shares.shares_valid??"N/A"," · Invalid ",s.tile_3_shares.shares_invalid??"N/A"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Driver recovery (24h)"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Recovered: ",(o==null?void 0:o.recovered_count)||0]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Unresolved: ",(o==null?void 0:o.unresolved_count)||0]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last event: ",o!=null&&o.last_event_at?P(o.last_event_at):"None"]})]})]}),(l==null?void 0:l.status)==="ok"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Proposal checker (DGB)"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${V?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":"border-amber-700/60 bg-amber-900/30 text-amber-300"}`,children:V?"Enabled":"Disabled"}),e.jsxs("span",{className:"text-xs text-slate-400",children:[Ne.toFixed(4),"%"]})]}),e.jsxs("div",{className:"mt-2 text-xl font-semibold text-slate-100",children:[n(je)," / ",n(Z)]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${V?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${Ne}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["checks ",n(u==null?void 0:u.total_checks)," · fails ",n(u==null?void 0:u.total_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(u==null?void 0:u.last_failure_reason)||"",children:["last failure ",(u==null?void 0:u.last_failure_reason)||"None"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Queue pressure"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:n(t==null?void 0:t.queue_depth)}),e.jsxs("div",{className:"text-xs text-slate-400",children:["max seen ",n(t==null?void 0:t.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["dropped ",n(t==null?void 0:t.total_dropped)," · retries ",n(t==null?void 0:t.total_retries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Write reliability"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:_e!==null?`${_e.toFixed(1)}%`:"N/A"}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ok/fail ",n(t==null?void 0:t.total_write_batches_ok)," / ",n(t==null?void 0:t.total_write_batches_failed)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["last write ",P((t==null?void 0:t.last_write_ok_at)||null)," · ",((Be=t==null?void 0:t.last_write_latency_ms)==null?void 0:Be.toFixed(1))??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Share pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:we!==null?`${we.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-xs text-slate-400",children:"accept rate"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["accepted ",n(d==null?void 0:d.shares_accepted)," · rejected ",n(d==null?void 0:d.shares_rejected)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["workers ",n(d==null?void 0:d.connected_workers)," · last share ",P((d==null?void 0:d.last_share_at)||null)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Block pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:n(d==null?void 0:d.blocks_accepted)}),e.jsx("div",{className:"text-xs text-slate-400",children:"accepted by node"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["candidates ",n(cs)," · rejected ",n(os)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(d==null?void 0:d.last_block_submit_result)||"",children:["last result ",(d==null?void 0:d.last_block_submit_result)||"N/A"]})]})]}),e.jsxs("div",{className:"border-t border-slate-700/60 pt-4",children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-wide text-slate-400",children:"Stratum DB health"}),(l==null?void 0:l.database_status)!=="ok"?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:["Unavailable: ",(l==null?void 0:l.database_error)||"No DB health response"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Connection Pool"}),e.jsx(Xe,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="critical"?"text-red-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-emerald-400"}`})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-xl font-semibold text-slate-100",children:[((ze=m==null?void 0:m.utilization_percent)==null?void 0:ze.toFixed(1))??"N/A","%"]}),e.jsx("span",{className:"text-xs text-slate-400",children:"utilized"})]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${z>90?"bg-red-500":z>80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${z}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:[n(m==null?void 0:m.checked_out),"/",n(m==null?void 0:m.total_capacity)," (",n((m==null?void 0:m.max_capacity_configured)??(m==null?void 0:m.total_capacity))," max)"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Active Queries"}),e.jsx(gs,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:n(f==null?void 0:f.active_connections)}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Slow (>1m): ",n(f==null?void 0:f.long_running_queries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Database Size"}),e.jsx(js,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:fs(f==null?void 0:f.database_size_mb)}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:"total storage"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Health Status"}),e.jsx(hs,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="healthy"?"text-emerald-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-red-400"}`})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${(a==null?void 0:a.status)==="healthy"?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":(a==null?void 0:a.status)==="warning"?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-red-700/60 bg-red-900/30 text-red-300"}`,children:((a==null?void 0:a.status)||"unknown").toUpperCase()})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:[(a==null?void 0:a.status)==="healthy"&&"All systems operational",(a==null?void 0:a.status)==="warning"&&"Pool usage high",(a==null?void 0:a.status)==="critical"&&"Pool nearly exhausted"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (last 24h)"}),e.jsxs("div",{className:"mb-3 text-xs text-slate-500",children:["Since ",((Ze=a==null?void 0:a.high_water_marks)==null?void 0:Ze.last_24h_date)||"N/A"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(p==null?void 0:p.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(p==null?void 0:p.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(p==null?void 0:p.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((Ve=p==null?void 0:p.db_pool_wait_seconds_sum)==null?void 0:Ve.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(p==null?void 0:p.slow_queries_peak)})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (since boot)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(g==null?void 0:g.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(g==null?void 0:g.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(g==null?void 0:g.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((Je=g==null?void 0:g.db_pool_wait_seconds_sum)==null?void 0:Je.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:n(g==null?void 0:g.slow_queries_peak)})]})]})]})]})]})]})]})]},s.pool_id)})})]})]})}export{Ls as default};
