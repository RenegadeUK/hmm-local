import{c as de,r as l,j as e,x as J,y as G,z as V,E as Y,F as X,o as y,A as Q,p as ge,q as je,s as ye,t as fe,G as be,H as Ne,v as ve,I as ce,J as Z,B as x,l as we,a as z,W as Se,K as Pe,m as le,C as D,f as T,d as ne,O as ke}from"./index-B9tpZVqd.js";import{u as H}from"./useMutation-BVrrD_u6.js";import{I as ee}from"./info-CHqVBBtz.js";import{L as Ce}from"./loader-2-DXk3HTwb.js";import{S as Ee}from"./shield-alert-BtHlSaGi.js";import{T as Me}from"./trash-2-DQp4s3Q1.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=de("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=de("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function De({open:d,mode:c,pool:t,isSubmitting:f,onOpenChange:g,onSubmit:U}){const[u,A]=l.useState(""),[b,o]=l.useState(""),[F,P]=l.useState(!0),[L,j]=l.useState(null),[N,k]=l.useState([]),[v,C]=l.useState(!0),[B,q]=l.useState(null);l.useEffect(()=>{let n=!0;return fetch("/api/pool-templates").then(r=>{if(!r.ok)throw new Error(`Failed to fetch templates: ${r.statusText}`);return r.json()}).then(r=>{n&&(k(r),C(!1))}).catch(r=>{n&&(q(r.message),C(!1))}),()=>{n=!1}},[]);const p=l.useMemo(()=>{const n=[],r=new Map;return N.forEach(i=>{const h=`${i.pool_display_name} · ${i.coin}`,w={key:i.template_id,name:i.display_name,url:i.url,port:i.port,group:h,subtitle:[i.region||"Global",i.mining_model==="solo"?"Solo mining":"Pool mining",i.fee_percent!==null&&i.fee_percent>0?`${i.fee_percent}% fee`:"0% fee"].join(" · ")};r.has(h)||r.set(h,[]),r.get(h).push(w)}),r.forEach((i,h)=>{n.push({label:h,options:i})}),n},[N]),E=l.useMemo(()=>{const n={};return p.forEach(r=>{r.options.forEach(i=>{n[i.key]=i})}),n},[p]),M=l.useMemo(()=>u?E[u]:null,[u,E]);l.useEffect(()=>{d?(c==="edit"&&t?(o(t.user||""),P(t.enabled)):(o(""),P(!0),A("")),j(null)):(o(""),A(""),j(null))},[d,c,t]);const O=async n=>{n.preventDefault();const r=b.trim();if(c==="add"&&!u){j("Select an approved pool provider to continue.");return}if(!r){j("Wallet address / username is required.");return}let i;if(c==="add"&&(i=E[u],!i)){j("Invalid pool preset selected.");return}const h={id:t==null?void 0:t.id,name:c==="add"?i.name:(t==null?void 0:t.name)||"",url:c==="add"?i.url:(t==null?void 0:t.url)||"",port:c==="add"?i.port:(t==null?void 0:t.port)||0,user:r,password:(t==null?void 0:t.password)||"x",enabled:F};try{await U(h),g(!1)}catch(w){j(w instanceof Error?w.message:"Failed to save pool settings.")}},m=c==="add"?"Add Mining Pool":"Edit Pool",W=c==="add"?"Select an approved provider and supply the wallet address or username you use with that pool.":"Update the wallet address / username and status for this pool. Provider settings remain locked for safety.",I=c==="edit"&&t;return e.jsx(J,{open:d,onOpenChange:g,children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(V,{children:[e.jsxs(Y,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-blue-400"}),m]}),e.jsx(X,{className:"text-gray-400",children:W})]}),e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[c==="add"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{htmlFor:"provider",children:"1️⃣ Pool Provider"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(ee,{className:"h-4 w-4"}),v?"Loading templates...":`${N.length} templates available`]})]}),v?e.jsxs("div",{className:"flex items-center justify-center p-8 text-gray-400",children:[e.jsx(Ce,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading pool templates..."})]}):B?e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:[e.jsx(Q,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:B})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ge,{value:u,onValueChange:A,children:[e.jsx(je,{id:"provider",children:e.jsx(ye,{placeholder:"Choose a pool"})}),e.jsx(fe,{children:p.map(n=>e.jsxs(be,{children:[e.jsx(Ne,{children:n.label}),n.options.map(r=>e.jsx(ve,{value:r.key,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:r.name}),r.subtitle&&e.jsx("span",{className:"text-xs text-gray-400",children:r.subtitle})]})},r.key))]},n.label))})]}),M&&e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900/60 p-4 text-sm",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:M.name}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[M.url,":",M.port]}),e.jsx("p",{className:"text-gray-500 mt-2",children:"These connection details are locked to ensure reliability."})]})]})]}),I&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Pool Name"}),e.jsx("input",{type:"text",value:t.name,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(y,{children:"URL"}),e.jsx("input",{type:"text",value:t.url,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Port"}),e.jsx("input",{type:"text",value:t.port,disabled:!0,className:"mt-2 w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{htmlFor:"wallet",children:"2️⃣ Wallet Address / Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"wallet",type:"text",value:b,onChange:n=>o(n.target.value),placeholder:"paste your Braiins username or Solopool wallet",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40",disabled:v}),e.jsx(ie,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:'This is the only editable field per pool. Passwords default to "x" for all approved providers.'})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{id:"enabled",checked:F,onCheckedChange:n=>P(!!n)}),e.jsx(y,{htmlFor:"enabled",className:"text-sm",children:"Pool enabled"})]}),L&&e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:[e.jsx(Q,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:L})]}),e.jsxs(Z,{className:"gap-3 sm:gap-2",children:[e.jsx(x,{type:"button",variant:"secondary",onClick:()=>g(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:f||v,className:"min-w-[140px]",children:f?"Saving…":c==="add"?"Add Pool":"Save Changes"})]})]})]})})}async function S(d,c){const t=await fetch(d,{headers:{"Content-Type":"application/json",...(c==null?void 0:c.headers)||{}},...c});if(!t.ok){const f=await t.json().catch(()=>({})),g=f.detail||f.message||`Request failed (${t.status})`;throw new Error(g)}if(t.status!==204)return t.json()}function Te(d){return typeof d!="number"?{label:"No data",className:"text-gray-400"}:d>=70?{label:"Healthy",className:"text-green-400"}:d>=40?{label:"Fair",className:"text-yellow-400"}:{label:"Critical",className:"text-red-400"}}function R(d,c=""){return d==null?"—":`${d}${c}`}function Ie(){const d=we(),[c,t]=l.useState("add"),[f,g]=l.useState(!1),[U,u]=l.useState(null),[A,b]=l.useState(!1),[o,F]=l.useState(null),[P,L]=l.useState(null),[j,N]=l.useState(!1),[k,v]=l.useState(!1),[C,B]=l.useState(""),[q,p]=l.useState(null),{data:E=[],isLoading:M,error:O}=z({queryKey:["pools"],queryFn:()=>S("/api/pools/")}),{data:m,isLoading:W,error:I}=z({queryKey:["pool-health-overview"],queryFn:()=>S("/api/pools/health/overview"),refetchInterval:6e4}),{data:n,refetch:r}=z({queryKey:["braiins-settings"],queryFn:()=>S("/api/settings/braiins")});l.useEffect(()=>{n&&(v(!!n.enabled),B(n.api_token||""))},[n]);const i=l.useMemo(()=>{const s=new Map;return m==null||m.pools.forEach(a=>s.set(a.pool_id,a)),s},[m]),h=H({mutationFn:s=>{const{id:a,..._}=s;return S("/api/pools/",{method:"POST",body:JSON.stringify(_)})},onSuccess:()=>{d.invalidateQueries({queryKey:["pools"]}),d.invalidateQueries({queryKey:["pool-health-overview"]})}}),w=H({mutationFn:s=>{if(!s.id)throw new Error("Pool ID missing");const{id:a,..._}=s;return S(`/api/pools/${a}`,{method:"PUT",body:JSON.stringify(_)})},onSuccess:()=>{d.invalidateQueries({queryKey:["pools"]}),d.invalidateQueries({queryKey:["pool-health-overview"]})}}),K=H({mutationFn:s=>S(`/api/pools/${s}`,{method:"DELETE"}),onSuccess:()=>{d.invalidateQueries({queryKey:["pools"]}),d.invalidateQueries({queryKey:["pool-health-overview"]})}}),$=H({mutationFn:s=>S("/api/settings/braiins",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{d.invalidateQueries({queryKey:["braiins-settings"]}),p("Settings saved"),setTimeout(()=>p(null),4e3)},onError:s=>{p(s.message),setTimeout(()=>p(null),5e3)}}),oe=h.isPending||w.isPending,se=l.useMemo(()=>[...E].sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),[E]),te=()=>{t("add"),u(null),g(!0)},xe=s=>{t("edit"),u(s),g(!0)},me=async s=>{c==="add"?await h.mutateAsync(s):await w.mutateAsync(s)},he=s=>{F(s),L(null),b(!0)},ue=async()=>{if(o)try{await K.mutateAsync(o.id),b(!1),F(null)}catch(s){L(s instanceof Error?s.message:"Unable to delete pool")}},pe=async()=>{if(k&&!C.trim()){p("API token is required when integration is enabled"),setTimeout(()=>p(null),4e3);return}try{await $.mutateAsync({enabled:k,api_token:C.trim()})}catch{}},ae=O instanceof Error?O.message:null,re=I instanceof Error?I.message:null;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{children:"Pools"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Pool Management"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review pool health, manage approved providers, and keep Braiins Pool telemetry in sync."}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",children:[e.jsxs(x,{onClick:te,className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Add Pool"]}),e.jsxs(x,{variant:"outline",onClick:()=>d.invalidateQueries({queryKey:["pool-health-overview"]}),className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Refresh Health"]})]})]}),m&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(D,{children:e.jsxs(T,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Pools"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:m.total_pools})]})}),e.jsx(D,{children:e.jsxs(T,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Healthy"}),e.jsxs("div",{className:"flex items-baseline gap-2 mt-2",children:[e.jsx("p",{className:"text-2xl font-semibold text-green-400",children:m.healthy_pools}),e.jsxs("span",{className:"text-sm text-gray-500",children:["/",m.total_pools]})]})]})}),e.jsx(D,{children:e.jsxs(T,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Response Time"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:R(m.avg_response_time_ms,"ms")})]})}),e.jsx(D,{children:e.jsxs(T,{className:"p-5",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Reject Rate"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:R(m.avg_reject_rate,"%")})]})})]}),(ae||re)&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:ae||re})]}),e.jsxs(D,{children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configured Pools"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Only approved Solopool and Braiins providers are shown."})]})}),e.jsx(T,{children:M||W?e.jsx("div",{className:"flex min-h-[200px] items-center justify-center text-gray-400",children:"Loading pools…"}):se.length===0?e.jsxs("div",{className:"rounded-md border border-dashed border-gray-700 p-8 text-center",children:[e.jsx("p",{className:"text-gray-300 font-medium",children:"No pools configured yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Use the Add Pool button to connect your preferred provider."}),e.jsx(x,{onClick:te,className:"mt-4",children:"Add Pool"})]}):e.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:se.map(s=>{const a=i.get(s.id),_=Te(a==null?void 0:a.health_score);return e.jsxs("div",{className:"rounded-xl border border-gray-800 bg-gray-950/60 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-semibold",children:s.name}),e.jsx("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${s.enabled?"bg-green-500/10 text-green-300":"bg-gray-600/20 text-gray-400"}`,children:s.enabled?"Enabled":"Disabled"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.url,":",s.port]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Worker: ",s.user]})]}),e.jsx("div",{className:`text-sm font-medium ${_.className}`,children:_.label})]}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Health Score"}),e.jsx("p",{className:"text-lg font-semibold",children:(a==null?void 0:a.health_score)??"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Response"}),e.jsx("p",{className:"text-lg font-semibold",children:R(a==null?void 0:a.response_time_ms,"ms")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:"Reject Rate"}),e.jsx("p",{className:"text-lg font-semibold",children:R(a==null?void 0:a.reject_rate,"%")})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3.5 w-3.5"}),"Active miners: ",(a==null?void 0:a.active_miners)??0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3.5 w-3.5"}),a!=null&&a.last_checked?new Date(a.last_checked).toLocaleTimeString():"No checks yet"]}),(a==null?void 0:a.error_message)&&e.jsxs("div",{className:"flex items-center gap-1 text-red-300",children:[e.jsx(Ee,{className:"h-3.5 w-3.5"}),a.error_message]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[e.jsxs(x,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:()=>xe(s),children:[e.jsx(_e,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(x,{variant:"destructive",size:"sm",className:"flex items-center gap-2",onClick:()=>he(s),disabled:K.isPending&&(o==null?void 0:o.id)===s.id,children:[e.jsx(Me,{className:"h-4 w-4"}),"Delete"]})]})]},s.id)})})})]}),e.jsxs(D,{children:[e.jsxs(ne,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Braiins Pool Integration"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Provide the API token to surface Braiins payouts and worker stats inside HMM."})]}),e.jsxs(x,{variant:"ghost",onClick:()=>N(!0),className:"flex items-center gap-2 text-blue-300",children:[e.jsx(ee,{className:"h-4 w-4"}),"How it works"]})]}),e.jsxs(T,{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{id:"braiins-enabled",checked:k,onCheckedChange:s=>v(!!s)}),e.jsx(y,{htmlFor:"braiins-enabled",children:"Enable Braiins Pool telemetry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"braiins-token",children:"API Token"}),e.jsx("input",{id:"braiins-token",type:"password",value:C,onChange:s=>B(s.target.value),disabled:!k,placeholder:"Access token from pool.braiins.com → Access Management",className:"w-full rounded-md border border-gray-700 bg-gray-900 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-600/40 disabled:opacity-60"}),e.jsx("p",{className:"text-xs text-gray-500",children:"We store tokens locally under /config and never send them outside your network."})]}),q&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-200",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:q})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(x,{onClick:pe,disabled:$.isPending,children:$.isPending?"Saving…":"Save Settings"}),e.jsx(x,{variant:"ghost",onClick:()=>r(),disabled:$.isPending,children:"Reload"})]})]})]}),e.jsx(De,{open:f,mode:c,pool:U,isSubmitting:oe,onOpenChange:s=>{g(s),s||(u(null),t("add"))},onSubmit:me}),e.jsx(J,{open:A,onOpenChange:b,children:e.jsxs(G,{children:[e.jsxs(V,{children:[e.jsx(Y,{className:"text-lg font-semibold",children:"Delete pool"}),e.jsx(X,{children:"This action removes the pool from every miner and automation rule. You can re-add it later using the approved presets."})]}),e.jsx("p",{className:"text-sm text-gray-300",children:o?`${o.name} (${o.url}:${o.port})`:""}),P&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-300",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:P})]}),e.jsxs(Z,{className:"gap-3",children:[e.jsx(x,{variant:"secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsx(x,{variant:"destructive",onClick:ue,disabled:K.isPending,children:K.isPending?"Deleting…":"Delete Pool"})]})]})}),e.jsx(J,{open:j,onOpenChange:N,children:e.jsxs(G,{children:[e.jsxs(V,{children:[e.jsx(Y,{children:"Braiins Pool API Help"}),e.jsx(X,{children:"Follow these steps to generate your token."})]}),e.jsxs("ol",{className:"list-decimal space-y-2 pl-6 text-sm text-gray-200",children:[e.jsx("li",{children:"Visit pool.braiins.com and sign in."}),e.jsx("li",{children:"Navigate to Settings → Access Management."}),e.jsx("li",{children:"Create a new Access Profile with read scope."}),e.jsx("li",{children:"Copy the generated API token and paste it here."})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tokens stay inside your HMM instance under /config/config.yaml so you remain in full control."}),e.jsx(Z,{children:e.jsx(x,{variant:"secondary",onClick:()=>N(!1),children:"Close"})})]})})]})}export{Ie as default};
