import{a as v,r as N,j as e,o as k,W as y,C as o,d as x,e as m,f as h,L as M,R as A,a1 as w}from"./index-Bmr6SSLE-1771275621629.js";import{C as T}from"./check-circle-2-BjHOq3OV-1771275621629.js";import{A as F}from"./alert-triangle-CAYGWDwT-1771275621629.js";const H="hmm_local_stratum";function g(t){return typeof t!="number"||!Number.isFinite(t)?"N/A":`${t.toFixed(2)}%`}function C(t){return typeof t!="number"||!Number.isFinite(t)?"N/A":t>=1e9?`${(t/1e9).toFixed(2)} EH/s`:t>=1e6?`${(t/1e6).toFixed(2)} PH/s`:t>=1e3?`${(t/1e3).toFixed(2)} TH/s`:`${t.toFixed(2)} GH/s`}function P(t){if(!t)return"Unknown";const u=new Date(t).getTime();if(Number.isNaN(u))return t;const r=Math.max(0,Math.floor((Date.now()-u)/1e3));if(r<60)return`${r}s ago`;const i=Math.floor(r/60);if(i<60)return`${i}m ago`;const d=Math.floor(i/60);return d<24?`${d}h ago`:`${Math.floor(d/24)}d ago`}function I(){var f;const t=v({queryKey:["integrations","hmm-local-stratum","tiles"],queryFn:()=>w.getPoolTiles(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),u=v({queryKey:["integrations","hmm-local-stratum","recovery-status"],queryFn:()=>w.getRecoveryStatus(24),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),r=N.useMemo(()=>Object.values(t.data||{}).filter(s=>s.pool_type===H),[t.data]),i=N.useMemo(()=>{var n;const s=new Map;for(const l of((n=u.data)==null?void 0:n.pools)||[])s.set(l.pool_id,l);return s},[(f=u.data)==null?void 0:f.pools]),d=N.useMemo(()=>{const s=r.reduce((a,p)=>a+(p.tile_2_network.active_workers||0),0),n=r.map(a=>a.tile_3_shares.reject_rate).filter(a=>typeof a=="number"&&Number.isFinite(a)),l=n.length>0?Math.max(...n):null,j=r.filter(a=>a.tile_1_health.health_status===!1).length,b=r.reduce((a,p)=>{const _=Number.parseInt(p.pool_id,10),c=Number.isNaN(_)?void 0:i.get(_);return a.recovered+=(c==null?void 0:c.recovered_count)||0,a.unresolved+=(c==null?void 0:c.unresolved_count)||0,a},{recovered:0,unresolved:0});return{workersOnline:s,maxRejectRate:l,unhealthyPools:j,recovered:b.recovered,unresolved:b.unresolved}},[i,r]);return t.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-blue-500"})}):t.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(y,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load Stratum operational data."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(y,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Dedicated operational view for local Stratum integration pools."})]}),r.length===0?e.jsxs(o,{children:[e.jsx(x,{children:e.jsx(m,{children:"No HMM-Local Stratum pool configured"})}),e.jsxs(h,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Add or update a pool with driver ",e.jsx("span",{className:"font-semibold text-foreground",children:"hmm_local_stratum"})," to populate this page."]}),e.jsx("div",{children:e.jsx(M,{className:"text-blue-400 hover:text-blue-300 underline",to:"/pools",children:"Go to Pools"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Configured pools"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:r.length}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[d.unhealthyPools," degraded"]})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Workers online"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:d.workersOnline}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Across all Stratum pools"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Max reject rate"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:g(d.maxRejectRate)}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"24h tile feed"})]})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Driver recoveries (24h)"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:d.recovered}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[d.unresolved," unresolved"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(s=>{const n=Number.parseInt(s.pool_id,10),l=Number.isNaN(n)?void 0:i.get(n);return e.jsxs(o,{children:[e.jsxs(x,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(m,{className:"text-lg",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/60 px-2 py-1 text-slate-300",children:[e.jsx(A,{className:"h-3 w-3"})," Updated ",P(s.last_updated)]}),s.tile_1_health.health_status?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(T,{className:"h-3 w-3"})," Healthy"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-amber-300",children:[e.jsx(F,{className:"h-3 w-3"})," Degraded"]})]})]}),(s.warnings||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(s.warnings||[]).map(j=>e.jsx("span",{className:"inline-flex rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-xs text-amber-300",children:j},`${s.pool_id}-${j}`))})]}),e.jsxs(h,{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Tile 1 · Health"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:s.tile_1_health.health_message||"No message"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Latency: ",s.tile_1_health.latency_ms??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Tile 2 · Network"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Workers: ",s.tile_2_network.active_workers??"N/A"]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Hashrate: ",C(s.tile_2_network.pool_hashrate)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Pool share: ",g(s.tile_2_network.pool_percentage)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Tile 3 · Shares"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Reject rate: ",g(s.tile_3_shares.reject_rate)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Valid ",s.tile_3_shares.shares_valid??"N/A"," · Invalid ",s.tile_3_shares.shares_invalid??"N/A"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Tile 4 · Blocks"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Blocks 24h: ",s.tile_4_blocks.blocks_found_24h??"N/A"]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Currency: ",s.tile_4_blocks.currency||"N/A"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Recovery: +",(l==null?void 0:l.recovered_count)||0," / unresolved ",(l==null?void 0:l.unresolved_count)||0]})]})]})]},s.pool_id)})})]})]})}export{I as default};
