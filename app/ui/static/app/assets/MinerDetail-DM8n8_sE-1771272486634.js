import{c as le,b as ne,u as ie,m as oe,r as E,a as x,n as N,j as e,C as u,f as h,A as Q,B as p,R as ce,L as de,d as _,S as me,o as xe,p as ue,q as he,s as R,t as pe,v as fe,w as je,x as ge,y as ye,z as A,N as ve,P as be}from"./index-Dd-CIDLG-1771272486634.js";import{P as we}from"./pen-square-D_SX89Em-1771272486634.js";import{T as Ne}from"./trash-2-B6FukW1Z-1771272486634.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);function $e(){const{minerId:l}=ne(),S=ie(),d=oe(),[f,O]=E.useState(""),[j,U]=E.useState(null),[g,W]=E.useState(!0),{data:y}=x({queryKey:["miners"],queryFn:async()=>{const s=await fetch("/api/dashboard/all?dashboard_type=all");if(!s.ok)throw new Error("Failed to fetch miners");return s.json()}}),o=y==null?void 0:y.miners.find(s=>s.id===parseInt(l||"0")),{data:c}=x({queryKey:["minerDetails",l],queryFn:async()=>{const s=await fetch(`/api/miners/${l}`);if(!s.ok)throw new Error("Failed to fetch miner details");return s.json()},enabled:!!l}),{data:a,isLoading:G,error:J}=x({queryKey:["telemetry",l],queryFn:async()=>{const s=await fetch(`/api/miners/${l}/telemetry`);if(!s.ok)throw new Error("Failed to fetch telemetry");return s.json()},refetchInterval:g?5e3:!1,enabled:!!l}),t=(a==null?void 0:a.extra_data)??{},T=t.current_mode,L=t.uptime_seconds??t.uptime,V=t.frequency_mhz??t.frequency,F=t.voltage_mv??t.voltage,X=t.best_share_diff??t.best_diff,Y=t.pool_difficulty??t.difficulty,C=t.pool_response_ms??t.response_time,$=t.error_rate_pct??t.error_percentage,D=t.firmware_version??t.version,K=t.core_voltage_mv??t.core_voltage,B=t.core_voltage_actual_mv??t.core_voltage_actual,I=t.vr_temp_c??t.vr_temp,k=t.free_heap_bytes??t.free_heap,H=t.wifi_rssi??t.rssi,P=t.hardware_errors??t.hw_errors,{data:M}=x({queryKey:["modes",l],queryFn:async()=>{const s=await fetch(`/api/miners/${l}/modes`);if(!s.ok)throw new Error("Failed to fetch modes");return s.json()},enabled:!!l}),{data:Z=[]}=x({queryKey:["pools"],queryFn:async()=>{const s=await fetch("/api/pools/");if(!s.ok)throw new Error("Failed to fetch pools");return s.json()}});x({queryKey:["devicePools",l],queryFn:async()=>{const s=await fetch(`/api/miners/${l}/device-pools`);return s.ok?s.json():[]},enabled:!!l});const v=N({mutationFn:async s=>{const i=await fetch(`/api/miners/${l}/mode?mode=${s}`,{method:"POST"});if(!i.ok)throw new Error("Failed to set mode");return i.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["telemetry",l]}),d.invalidateQueries({queryKey:["miners"]})}}),b=N({mutationFn:async s=>{const i=await fetch(`/api/miners/${l}/pool?pool_id=${s}`,{method:"POST"});if(!i.ok)throw new Error("Failed to switch pool");return i.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["telemetry",l]}),d.invalidateQueries({queryKey:["devicePools",l]})}}),w=N({mutationFn:async()=>{const s=await fetch(`/api/miners/${l}/restart`,{method:"POST"});if(!s.ok)throw new Error("Failed to restart miner");return s.json()}}),z=N({mutationFn:async()=>{const s=await fetch(`/api/miners/${l}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete miner");return s.json()},onSuccess:()=>{S("/miners")}}),ee=()=>{f&&v.mutate(f)},se=()=>{j!==null&&b.mutate(j)},ae=()=>{confirm("Are you sure you want to restart this miner?")&&w.mutate()},te=()=>{confirm(`Are you sure you want to delete ${o==null?void 0:o.name}? This cannot be undone.`)&&z.mutate()},re=s=>{const i=Math.floor(s/86400),n=Math.floor(s%86400/3600),q=Math.floor(s%3600/60);return i>0?`${i}d ${n}h ${q}m`:n>0?`${n}h ${q}m`:`${q}m`},m=(s,i=2)=>{if(s==null)return"â€”";const n=typeof s=="string"?parseFloat(s):s;return isNaN(n)?"â€”":n>=1e9?`${(n/1e9).toFixed(2)}B`:n>=1e6?`${(n/1e6).toFixed(2)}M`:n>=1e3?`${(n/1e3).toFixed(2)}K`:n.toFixed(i)};return y?o?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:o.name}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:o.miner_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>W(!g),className:"gap-2",children:[e.jsx(ce,{className:`h-4 w-4 ${g?"animate-spin":""}`}),g?"Auto":"Manual"]}),e.jsx(p,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(de,{to:`/miners/${l}/edit`,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(p,{variant:"destructive",size:"sm",onClick:te,disabled:z.isPending,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(u,{children:[e.jsxs(_,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(me,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Configuration"})]}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Status"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${o.enabled?"bg-green-500/10 text-green-400 border border-green-500/20":"bg-gray-500/10 text-gray-400 border border-gray-500/20"}`,children:o.enabled?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Type"}),e.jsx("span",{className:"text-sm font-medium",children:o.miner_type})]}),(c==null?void 0:c.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"IP Address"}),e.jsx("span",{className:"text-sm font-medium",children:c.ip_address})]}),(c==null?void 0:c.ip_address)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"URL"}),e.jsx("a",{href:`http://${c.ip_address}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 hover:underline",children:"Open Device"})]}),T&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Mode"}),e.jsx("span",{className:"text-sm font-medium",children:T})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Current Pool"}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[150px]",children:(a==null?void 0:a.pool_in_use)||"â€”"})]})]})]}),e.jsxs(u,{className:"lg:col-span-2",children:[e.jsxs(_,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(xe,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Live Telemetry"}),a&&e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[e.jsx(_e,{className:"h-3 w-3 inline mr-1"}),new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs(h,{children:[G&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading telemetry..."}),J&&e.jsxs("div",{className:"flex items-center gap-3 text-red-400 p-4 bg-red-500/10 rounded-lg border border-red-500/20",children:[e.jsx(Q,{className:"h-5 w-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:"Failed to load telemetry data"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[a.hashrate!==null&&a.hashrate!==void 0&&e.jsx(r,{label:"Hashrate",value:typeof a.hashrate=="object"?a.hashrate.display:ue(a.hashrate)}),a.temperature!==null&&a.temperature!==void 0&&e.jsx(r,{label:"Temperature",value:`${a.temperature.toFixed(1)}Â°C`}),a.power_watts!==null&&a.power_watts!==void 0&&e.jsx(r,{label:"Power",value:`${a.power_watts.toFixed(1)} W`}),a.shares_accepted!==null&&a.shares_accepted!==void 0&&e.jsx(r,{label:"Accepted",value:a.shares_accepted.toString()}),a.shares_rejected!==null&&a.shares_rejected!==void 0&&e.jsx(r,{label:"Rejected",value:a.shares_rejected.toString()}),e.jsx(r,{label:"Uptime",value:L?re(L):"â€”"})]})]})]})]}),a&&e.jsxs(u,{children:[e.jsx(_,{children:e.jsx("h3",{className:"font-semibold",children:"Extended Stats"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[e.jsx(r,{label:"Frequency",value:V?`${V} MHz`:"â€”"}),e.jsx(r,{label:"Voltage",value:F!=null?`${(F/1e3).toFixed(2)} V`:"â€”"}),e.jsx(r,{label:"Best Diff",value:m(X)}),e.jsx(r,{label:"Best Session",value:m(a.extra_data.best_session_diff)}),e.jsx(r,{label:"Pool Difficulty",value:m(Y)}),e.jsx(r,{label:"Network Diff",value:m(a.extra_data.network_difficulty)}),e.jsx(r,{label:"Pool Response",value:C!=null?`${C.toFixed(0)} ms`:"â€”"}),e.jsx(r,{label:"Error Rate",value:$!=null?`${$.toFixed(2)}%`:"â€”"}),e.jsx(r,{label:"WiFi Signal",value:H?String(H):"â€”"}),e.jsx(r,{label:"Firmware",value:D?String(D):"â€”"}),a.extra_data.found_blocks!==void 0&&e.jsx(r,{label:"Found Blocks ðŸŽ‰",value:a.extra_data.found_blocks.toString()}),P!=null&&e.jsx(r,{label:"HW Errors",value:String(P)}),K&&e.jsx(r,{label:"Core Voltage",value:`${K} mV`}),B&&e.jsx(r,{label:"Core V Actual",value:`${B} mV`}),I!==void 0&&e.jsx(r,{label:"VR Temp",value:`${I}Â°C`}),a.extra_data.small_core_count&&e.jsx(r,{label:"Small Cores",value:a.extra_data.small_core_count.toString()}),a.extra_data.asic_model&&e.jsx(r,{label:"ASIC Model",value:a.extra_data.asic_model}),a.extra_data.block_height&&e.jsx(r,{label:"Block Height",value:m(a.extra_data.block_height,0)}),a.extra_data.stratum_suggested_difficulty&&e.jsx(r,{label:"Stratum Diff",value:m(a.extra_data.stratum_suggested_difficulty)}),k!=null&&e.jsx(r,{label:"Free Heap",value:`${(k/1024/1024).toFixed(1)} MB`}),a.extra_data.fan_rpm!==null&&a.extra_data.fan_rpm!==void 0&&e.jsx(r,{label:"Fan RPM",value:a.extra_data.fan_rpm.toString()})]})})]}),e.jsxs(u,{children:[e.jsxs(_,{className:"flex flex-row items-center gap-3 pb-3",children:[e.jsx(he,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"font-semibold",children:"Controls"})]}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{children:"Operating Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(pe,{value:f,onValueChange:O,children:[e.jsx(fe,{className:"flex-1",children:e.jsx(je,{placeholder:"Select mode..."})}),e.jsx(ge,{children:M==null?void 0:M.modes.map(s=>e.jsx(ye,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx(p,{onClick:ee,disabled:!f||v.isPending,children:v.isPending?"Applying...":"Apply Mode"})]}),v.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Mode updated successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{children:"Pool Selection"}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:Z.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg border border-gray-700 hover:bg-gray-800/50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"pool",value:s.id,checked:j===s.id,onChange:()=>U(s.id),className:"text-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-400 truncate",children:[s.url,":",s.port]})]})]},s.id))}),e.jsxs(p,{onClick:se,disabled:j===null||b.isPending,className:"w-full",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),b.isPending?"Switching...":"Switch Pool"]}),b.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Pool switched successfully"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{children:"Device Control"}),e.jsxs(p,{onClick:ae,disabled:w.isPending,variant:"outline",className:"w-full gap-2 text-orange-400 hover:text-orange-300 border-orange-500/20",children:[e.jsx(be,{className:"h-4 w-4"}),w.isPending?"Restarting...":"Restart Miner"]}),w.isSuccess&&e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[e.jsx(A,{className:"h-4 w-4"}),"Restart command sent"]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsx(u,{className:"border-red-500/20 bg-red-500/5",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(Q,{className:"h-5 w-5"}),e.jsx("p",{children:"Miner not found"})]})})})}):e.jsx("div",{className:"p-6",children:e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-400 border-t-transparent rounded-full"}),e.jsx("p",{children:"Loading..."})]})})})})}function r({label:l,value:S,className:d=""}){return e.jsxs("div",{className:`bg-gray-800/50 rounded-lg p-3 border border-gray-700/50 ${d}`,children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide mb-1",children:l}),e.jsx("div",{className:"font-semibold text-sm truncate",children:S})]})}export{$e as default};
