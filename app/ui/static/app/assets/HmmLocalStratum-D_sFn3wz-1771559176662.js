import{m as ls,r as g,a as D,n as rs,j as e,o as Be,W as Ke,C as k,d as S,e as F,f as A,L as ds,R as is,T as ns,a1 as I,a2 as ze}from"./index-DepzAFf6-1771559176662.js";import{C as cs}from"./check-circle-2-B4BQa8-y-1771559176662.js";import{A as os}from"./alert-triangle-P8s7QBfN-1771559176662.js";import{Z as xs}from"./zap-DLIf5KSn-1771559176662.js";import{H as ms}from"./hard-drive-D-9GF0-H-1771559176662.js";const Ze="hmm_local_stratum";function hs(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":`${d.toFixed(2)}%`}function r(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":new Intl.NumberFormat().format(d)}function us(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":d>=1024?`${(d/1024).toFixed(2)} GB`:`${d.toFixed(1)} MB`}function Ve(d){if(!d)return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const m=new Date(d).getTime();if(Number.isNaN(m))return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const f=Math.max(0,Math.floor((Date.now()-m)/1e3));return f<=60?{label:"Fresh",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}:f<=180?{label:"Aging",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Stale",className:"border-red-700/60 bg-red-900/30 text-red-300"}}function bs(d){return typeof d!="number"||!Number.isFinite(d)?{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"}:d>=5?{label:"High",className:"border-red-700/60 bg-red-900/30 text-red-300"}:d>=3?{label:"Elevated",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Normal",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}}function $(d){if(!d)return"Unknown";const m=new Date(d).getTime();if(Number.isNaN(m))return d;const f=Math.max(0,Math.floor((Date.now()-m)/1e3));if(f<60)return`${f}s ago`;const v=Math.floor(f/60);if(v<60)return`${v}m ago`;const L=Math.floor(v/60);return L<24?`${L}h ago`:`${Math.floor(L/24)}d ago`}function ps(d){if(!d)return"Unknown";const m=new Date(d);return Number.isNaN(m.getTime())?d:m.toISOString().replace("T"," ").replace(".000Z","Z")}function Je(d,m=8){return d?d.length<=m*2+3?d:`${d.slice(0,m)}...${d.slice(-m)}`:"N/A"}function gs(d){if(d.accepted_by_node)return{label:"Accepted",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"};const m=String(d.reject_category||"").toLowerCase();return m.includes("invalid")||m.includes("bad")||m.includes("rpc_error")?{label:"Rejected",className:"border-red-700/60 bg-red-900/30 text-red-300"}:{label:"Inconclusive",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}}function ys(){var X,G,H,ee,se,te,ae,le,re,de,ie,ne,ce,oe;const d=ls(),[m,f]=g.useState(!1),[v,L]=g.useState(!1),[U,W]=g.useState(null),[z,Z]=g.useState(!0),[V,J]=g.useState(!0),[E,Y]=g.useState(!1),[P,R]=g.useState(null),o=D({queryKey:["integrations","hmm-local-stratum","settings"],queryFn:()=>I.getHmmLocalStratumSettings(),staleTime:3e4});g.useEffect(()=>{var t,n,h,c,l,s,a;typeof((t=o.data)==null?void 0:t.enabled)=="boolean"&&f(o.data.enabled),typeof((n=o.data)==null?void 0:n.failover_enabled)=="boolean"&&L(o.data.failover_enabled),((h=o.data)==null?void 0:h.backup_pool_id)===null||((c=o.data)==null?void 0:c.backup_pool_id)===void 0?W(null):W(Number(o.data.backup_pool_id)),typeof((l=o.data)==null?void 0:l.local_stratum_enabled)=="boolean"&&Z(o.data.local_stratum_enabled),typeof((s=o.data)==null?void 0:s.hard_lock_enabled)=="boolean"&&J(o.data.hard_lock_enabled),typeof((a=o.data)==null?void 0:a.hard_lock_active)=="boolean"&&Y(o.data.hard_lock_active)},[o.data]);const _=rs({mutationFn:()=>I.saveHmmLocalStratumSettings({enabled:m,failover_enabled:v,backup_pool_id:U,local_stratum_enabled:z,hard_lock_enabled:V,hard_lock_active:E}),onSuccess:t=>{R({tone:"success",message:t.message||"Settings saved"}),d.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),d.invalidateQueries({queryKey:["layout","stratum-dashboards-enabled"]}),setTimeout(()=>R(null),3500)},onError:t=>{R({tone:"error",message:t.message||"Failed to save settings"}),setTimeout(()=>R(null),3500)}}),C=D({queryKey:["integrations","hmm-local-stratum","tiles"],queryFn:()=>ze.getPoolTiles(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),M=D({queryKey:["integrations","hmm-local-stratum","recovery-status"],queryFn:()=>ze.getRecoveryStatus(24),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),y=D({queryKey:["integrations","hmm-local-stratum","operational"],queryFn:()=>I.getHmmLocalStratumOperational(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),j=D({queryKey:["integrations","hmm-local-stratum","candidate-incidents"],queryFn:()=>I.getHmmLocalStratumCandidateIncidents(24,50),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),N=g.useMemo(()=>Object.values(C.data||{}).filter(t=>t.pool_type===Ze),[C.data]),Ye=g.useMemo(()=>Object.values(C.data||{}).filter(t=>t.pool_type!==Ze).sort((t,n)=>t.display_name.localeCompare(n.display_name)),[C.data]),O=g.useMemo(()=>{var n;const t=new Map;for(const h of((n=M.data)==null?void 0:n.pools)||[])t.set(String(h.pool_id),h);return t},[(X=M.data)==null?void 0:X.pools]),Xe=g.useMemo(()=>{var n;const t=new Map;for(const h of((n=M.data)==null?void 0:n.pools)||[]){const c=String(h.pool_name||"").trim().toLowerCase();c&&t.set(c,h)}return t},[(G=M.data)==null?void 0:G.pools]),Ge=g.useMemo(()=>{var n,h,c;const t=new Map;for(const l of((n=y.data)==null?void 0:n.pools)||[])((h=l.pool)==null?void 0:h.id)!==null&&((c=l.pool)==null?void 0:c.id)!==void 0&&t.set(String(l.pool.id),l);return t},[(H=y.data)==null?void 0:H.pools]),He=g.useMemo(()=>{var n,h;const t=new Map;for(const c of((n=y.data)==null?void 0:n.pools)||[]){const l=String(((h=c.pool)==null?void 0:h.name)||"").trim().toLowerCase();l&&t.set(l,c)}return t},[(ee=y.data)==null?void 0:ee.pools]),T=g.useMemo(()=>{const t=N.filter(l=>l.tile_1_health.health_status===!1).length,n=N.reduce((l,s)=>{const a=O.get(String(s.pool_id));return l.recovered+=(a==null?void 0:a.recovered_count)||0,l.unresolved+=(a==null?void 0:a.unresolved_count)||0,l},{recovered:0,unresolved:0}),h=N.filter(l=>Ve(l.last_updated).label==="Stale").length,c=N.reduce((l,s)=>{var a;return l+(((a=s.warnings)==null?void 0:a.length)||0)},0);return{unhealthyPools:t,staleFeeds:h,driverWarnings:c,recovered:n.recovered,unresolved:n.unresolved}},[O,N]);return C.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Be,{className:"h-8 w-8 animate-spin text-blue-500"})}):C.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Ke,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load Stratum operational data."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Ke,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Dedicated operational status view for local Stratum integration pools."})]}),P&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${P.tone==="success"?"border-emerald-700/60 bg-emerald-900/30 text-emerald-200":P.tone==="error"?"border-red-700/60 bg-red-900/30 text-red-200":"border-blue-700/60 bg-blue-900/30 text-blue-200"}`,children:P.message}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(F,{children:"HMM-Local Stratum dashboards"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:m,onChange:t=>f(t.target.checked),disabled:o.isLoading||_.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable dedicated HMM-Local Stratum dashboards"}),e.jsx("div",{className:"text-xs text-slate-400",children:"When enabled, a new top-level navigation section appears with BTC, BCH and DGB pages focused on mining pool data."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:v,onChange:t=>L(t.target.checked),disabled:o.isLoading||_.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable strategy backup-pool failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Strategy-managed miners fail over to a backup pool when local stratum is marked unavailable."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Backup pool"}),e.jsxs("select",{className:"mt-2 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100",value:U??"",onChange:t=>{const n=t.target.value;W(n?Number(n):null)},disabled:o.isLoading||_.isPending||!v,children:[e.jsx("option",{value:"",children:"Select backup pool"}),Ye.map(t=>e.jsx("option",{value:t.pool_id,children:t.display_name},t.pool_id))]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:z,onChange:t=>Z(t.target.checked),disabled:o.isLoading||_.isPending||!v}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Local stratum currently available"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Disable this to route strategy miners to backup pool."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:V,onChange:t=>J(t.target.checked),disabled:o.isLoading||_.isPending||!v}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable hard-lock on failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Keep miners on backup until you clear hard-lock manually."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-200",children:"Hard-lock status"}),e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${E?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-emerald-700/60 bg-emerald-900/30 text-emerald-300"}`,children:E?"Active":"Inactive"})]}),E&&e.jsx("button",{type:"button",className:"mt-3 inline-flex items-center rounded-md border border-amber-700/60 bg-amber-900/30 px-3 py-2 text-xs text-amber-200 hover:bg-amber-900/40 disabled:opacity-50",onClick:()=>Y(!1),disabled:o.isLoading||_.isPending,children:"Resume primary (clear hard-lock)"})]}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-blue-700/60 bg-blue-900/30 px-3 py-2 text-sm text-blue-200 hover:bg-blue-900/40 disabled:opacity-50",onClick:()=>_.mutate(),disabled:_.isPending||o.isLoading,children:_.isPending?"Saving…":"Save setting"})]})]}),N.length===0?e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(F,{children:"No HMM-Local Stratum pool configured"})}),e.jsxs(A,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Add or update a pool with driver ",e.jsx("span",{className:"font-semibold text-foreground",children:"hmm_local_stratum"})," to populate this page."]}),e.jsx("div",{children:e.jsx(ds,{className:"text-blue-400 hover:text-blue-300 underline",to:"/pools",children:"Go to Pools"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Configured pools"})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:N.length}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[T.unhealthyPools," degraded"]})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Data freshness risk"})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.staleFeeds}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Stale feeds (> 3m old)"})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Driver warnings"})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.driverWarnings}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Unresolved / not-loaded flags"})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Driver recoveries (24h)"})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.recovered}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[T.unresolved," unresolved"]})]})]})]}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(F,{children:"Candidate incidents (24h)"})}),e.jsx(A,{className:"space-y-4",children:j.isLoading?e.jsx("div",{className:"text-sm text-slate-300",children:"Loading candidate incidents…"}):j.isError?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-sm text-amber-300",children:["Failed to load candidate incidents: ",((se=j.error)==null?void 0:se.message)||"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Accepted: ",((te=j.data)==null?void 0:te.summary.accepted)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rejected: ",((ae=j.data)==null?void 0:ae.summary.rejected)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rows: ",((le=j.data)==null?void 0:le.count)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-400",children:["Updated ",$(((re=j.data)==null?void 0:re.fetched_at)||null)]})]}),(((ie=(de=j.data)==null?void 0:de.fetch_errors)==null?void 0:ie.length)||0)>0&&e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:"Some Stratum endpoints were unavailable. Showing partial results."}),(((ce=(ne=j.data)==null?void 0:ne.rows)==null?void 0:ce.length)||0)===0?e.jsx("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 text-sm text-slate-300",children:"No candidate incidents in the last 24 hours."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700/60",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-slate-900/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-medium",children:"Time (UTC)"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Coin"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Worker"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Job"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Template"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Block"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Result"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Category"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Latency"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Variant"})]})}),e.jsx("tbody",{children:(((oe=j.data)==null?void 0:oe.rows)||[]).map(t=>{const n=gs(t);return e.jsxs("tr",{className:"border-t border-slate-800/70 text-slate-200",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:ps(t.ts)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.coin||"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.worker||"",children:Je(t.worker,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.job_id||"N/A"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.template_height??"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.block_hash||"",children:Je(t.block_hash,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 ${n.className}`,children:n.label})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.reject_category||"accepted"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:typeof t.latency_ms=="number"?`${t.latency_ms.toFixed(2)} ms`:"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.matched_variant||"",children:t.matched_variant||"N/A"})]},`${t.ts}-${t.coin}-${t.job_id||"no-job"}`)})})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:N.map(t=>{var ve,_e,ye,we,ke,Se,Fe,Ae,Le,Ce,Me,qe,$e,Te,De,Ee,Pe,Re,Ie,Ue,We,Oe;const n=String(t.pool_id||"").trim(),h=String(t.display_name||"").trim().toLowerCase(),c=(n?O.get(n):void 0)||Xe.get(h)||(N.length===1&&(((_e=(ve=M.data)==null?void 0:ve.pools)==null?void 0:_e.length)||0)===1?(we=(ye=M.data)==null?void 0:ye.pools)==null?void 0:we[0]:void 0),l=(n?Ge.get(n):void 0)||He.get(h)||(N.length===1&&(((Se=(ke=y.data)==null?void 0:ke.pools)==null?void 0:Se.length)||0)===1?(Ae=(Fe=y.data)==null?void 0:Fe.pools)==null?void 0:Ae[0]:void 0),s=(Le=l==null?void 0:l.stats)==null?void 0:Le.datastore,a=l==null?void 0:l.database,u=a==null?void 0:a.pool,w=a==null?void 0:a.postgresql,b=(Ce=a==null?void 0:a.high_water_marks)==null?void 0:Ce.last_24h,p=(Me=a==null?void 0:a.high_water_marks)==null?void 0:Me.since_boot,Q=Math.max(0,Math.min(100,Number((u==null?void 0:u.utilization_percent)||0))),q=String(t.tile_4_blocks.currency||"").toUpperCase(),i=q?($e=(qe=l==null?void 0:l.stats)==null?void 0:qe.coins)==null?void 0:$e[q]:void 0,x=(Te=l==null?void 0:l.stats)==null?void 0:Te.dgb_proposal_guard,B=Number((x==null?void 0:x.required_consecutive_passes)||25e3),xe=Number((x==null?void 0:x.consecutive_passes)||0),me=B>0?Math.max(0,Math.min(100,xe/B*100)):0,K=!!(x!=null&&x.submit_enabled),he=Number((s==null?void 0:s.total_write_batches_ok)||0),es=Number((s==null?void 0:s.total_write_batches_failed)||0),ue=he+es,be=ue>0?he/ue*100:null,pe=Number((i==null?void 0:i.shares_accepted)||0),ss=Number((i==null?void 0:i.shares_rejected)||0),ge=pe+ss,je=ge>0?pe/ge*100:null,ts=Number((i==null?void 0:i.block_candidates)||0),as=Number((i==null?void 0:i.blocks_rejected)||0),Ne=Ve(t.last_updated),fe=bs(t.tile_3_shares.reject_rate);return e.jsxs(k,{children:[e.jsxs(S,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(F,{className:"text-lg",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/60 px-2 py-1 text-slate-300",children:[e.jsx(is,{className:"h-3 w-3"})," Updated ",$(t.last_updated)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-1 ${Ne.className}`,children:["Feed ",Ne.label]}),t.tile_1_health.health_status?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(cs,{className:"h-3 w-3"})," Healthy"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-amber-300",children:[e.jsx(os,{className:"h-3 w-3"})," Degraded"]})]})]}),(t.warnings||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.warnings||[]).map(Qe=>e.jsx("span",{className:"inline-flex rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-xs text-amber-300",children:Qe},`${t.pool_id}-${Qe}`))})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Service health"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:t.tile_1_health.health_message||"No message"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Latency: ",t.tile_1_health.latency_ms??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Operational info (/stats)"}),y.isLoading?e.jsx("div",{className:"mt-1 text-sm text-slate-300",children:"Loading operational stats…"}):y.isError?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:((De=y.error)==null?void 0:De.message)||"Operational query failed"})]}):(l==null?void 0:l.status)!=="ok"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:(l==null?void 0:l.error)||"No response from Stratum API"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Queue: ",r(s==null?void 0:s.queue_depth)," / max seen ",r(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Rows written: ",r(s==null?void 0:s.total_rows_written)," · Dropped: ",r(s==null?void 0:s.total_dropped)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Batches ok/fail: ",r(s==null?void 0:s.total_write_batches_ok)," / ",r(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Enqueued: ",r(s==null?void 0:s.total_enqueued)," · Spooled/Replayed: ",r(s==null?void 0:s.total_spooled_rows)," / ",r(s==null?void 0:s.total_replayed_rows)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retries: ",r(s==null?void 0:s.total_retries)," · Consecutive failures: ",r(s==null?void 0:s.consecutive_write_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last write: ",$((s==null?void 0:s.last_write_ok_at)||null)," · Latency: ",((Ee=s==null?void 0:s.last_write_latency_ms)==null?void 0:Ee.toFixed(2))??"N/A"," ms"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["DB: ",(Pe=l.stats)!=null&&Pe.db_enabled?"enabled":"disabled"," · Datastore: ",s!=null&&s.enabled?"enabled":"disabled"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retention (d): H ",r(s==null?void 0:s.hashrate_retention_days)," · N ",r(s==null?void 0:s.network_retention_days)," · K ",r(s==null?void 0:s.kpi_retention_days)]}),(s==null?void 0:s.spool_path)&&e.jsxs("div",{className:"truncate text-xs text-slate-500",title:s.spool_path,children:["Spool path: ",s.spool_path]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Quality / reliability"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${fe.className}`,children:["Reject risk: ",fe.label]})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Reject rate: ",hs(t.tile_3_shares.reject_rate)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid ",t.tile_3_shares.shares_valid??"N/A"," · Invalid ",t.tile_3_shares.shares_invalid??"N/A"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Driver recovery (24h)"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Recovered: ",(c==null?void 0:c.recovered_count)||0]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Unresolved: ",(c==null?void 0:c.unresolved_count)||0]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last event: ",c!=null&&c.last_event_at?$(c.last_event_at):"None"]})]})]}),(l==null?void 0:l.status)==="ok"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Proposal checker (DGB)"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${K?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":"border-amber-700/60 bg-amber-900/30 text-amber-300"}`,children:K?"Enabled":"Disabled"}),e.jsxs("span",{className:"text-xs text-slate-400",children:[me.toFixed(4),"%"]})]}),e.jsxs("div",{className:"mt-2 text-xl font-semibold text-slate-100",children:[r(xe)," / ",r(B)]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${K?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${me}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["checks ",r(x==null?void 0:x.total_checks)," · fails ",r(x==null?void 0:x.total_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(x==null?void 0:x.last_failure_reason)||"",children:["last failure ",(x==null?void 0:x.last_failure_reason)||"None"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Queue pressure"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(s==null?void 0:s.queue_depth)}),e.jsxs("div",{className:"text-xs text-slate-400",children:["max seen ",r(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["dropped ",r(s==null?void 0:s.total_dropped)," · retries ",r(s==null?void 0:s.total_retries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Write reliability"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:be!==null?`${be.toFixed(1)}%`:"N/A"}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ok/fail ",r(s==null?void 0:s.total_write_batches_ok)," / ",r(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["last write ",$((s==null?void 0:s.last_write_ok_at)||null)," · ",((Re=s==null?void 0:s.last_write_latency_ms)==null?void 0:Re.toFixed(1))??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Share pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:je!==null?`${je.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-xs text-slate-400",children:"accept rate"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["accepted ",r(i==null?void 0:i.shares_accepted)," · rejected ",r(i==null?void 0:i.shares_rejected)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["workers ",r(i==null?void 0:i.connected_workers)," · last share ",$((i==null?void 0:i.last_share_at)||null)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Block pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(i==null?void 0:i.blocks_accepted)}),e.jsx("div",{className:"text-xs text-slate-400",children:"accepted by node"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["candidates ",r(ts)," · rejected ",r(as)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(i==null?void 0:i.last_block_submit_result)||"",children:["last result ",(i==null?void 0:i.last_block_submit_result)||"N/A"]})]})]}),e.jsxs("div",{className:"border-t border-slate-700/60 pt-4",children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-wide text-slate-400",children:"Stratum DB health"}),(l==null?void 0:l.database_status)!=="ok"?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:["Unavailable: ",(l==null?void 0:l.database_error)||"No DB health response"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Connection Pool"}),e.jsx(Be,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="critical"?"text-red-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-emerald-400"}`})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-xl font-semibold text-slate-100",children:[((Ie=u==null?void 0:u.utilization_percent)==null?void 0:Ie.toFixed(1))??"N/A","%"]}),e.jsx("span",{className:"text-xs text-slate-400",children:"utilized"})]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${Q>90?"bg-red-500":Q>80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Q}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:[r(u==null?void 0:u.checked_out),"/",r(u==null?void 0:u.total_capacity)," (",r((u==null?void 0:u.max_capacity_configured)??(u==null?void 0:u.total_capacity))," max)"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Active Queries"}),e.jsx(xs,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(w==null?void 0:w.active_connections)}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Slow (>1m): ",r(w==null?void 0:w.long_running_queries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Database Size"}),e.jsx(ms,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:us(w==null?void 0:w.database_size_mb)}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:"total storage"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Health Status"}),e.jsx(ns,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="healthy"?"text-emerald-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-red-400"}`})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${(a==null?void 0:a.status)==="healthy"?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":(a==null?void 0:a.status)==="warning"?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-red-700/60 bg-red-900/30 text-red-300"}`,children:((a==null?void 0:a.status)||"unknown").toUpperCase()})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:[(a==null?void 0:a.status)==="healthy"&&"All systems operational",(a==null?void 0:a.status)==="warning"&&"Pool usage high",(a==null?void 0:a.status)==="critical"&&"Pool nearly exhausted"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (last 24h)"}),e.jsxs("div",{className:"mb-3 text-xs text-slate-500",children:["Since ",((Ue=a==null?void 0:a.high_water_marks)==null?void 0:Ue.last_24h_date)||"N/A"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(b==null?void 0:b.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(b==null?void 0:b.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(b==null?void 0:b.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((We=b==null?void 0:b.db_pool_wait_seconds_sum)==null?void 0:We.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(b==null?void 0:b.slow_queries_peak)})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (since boot)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((Oe=p==null?void 0:p.db_pool_wait_seconds_sum)==null?void 0:Oe.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.slow_queries_peak)})]})]})]})]})]})]})]})]},t.pool_id)})})]})]})}export{ys as default};
