import{m as D,r as d,a as I,n as q,j as e,af as Q,C as H,d as K,e as O,B as f,Y as u,f as U,ag as E,A,a0 as S}from"./index-jiChOnHh-1770671741521.js";import{h as W}from"./textFormatters-DoRLJPXQ-1770671741521.js";import{L as T}from"./loader-2-DF5aQJiv-1770671741521.js";import{R as G}from"./refresh-ccw-CMa4miuj-1770671741521.js";import{T as J}from"./trash-2-C_DCGAEp-1770671741521.js";import{C as V}from"./check-circle-2-Db7BvYUz-1770671741521.js";const N=200,Y=[{label:"All",value:"all"},{label:"Info",value:"info"},{label:"Success",value:"success"},{label:"Warning",value:"warning"},{label:"Error",value:"error"}];function xe(){const t=D(),[s,o]=d.useState("all"),[a,x]=d.useState(1),[l,g]=d.useState(!0),[m,j]=d.useState(null),n=I({queryKey:["system-logs"],queryFn:()=>E.getEvents(1e3).then(r=>r.events),refetchInterval:l?3e4:!1}),i=d.useMemo(()=>n.data??[],[n.data]);d.useEffect(()=>{x(1)},[s,i.length]),d.useEffect(()=>{if(!m)return;const r=window.setTimeout(()=>j(null),4e3);return()=>window.clearTimeout(r)},[m]);const C=(r,c)=>{j({tone:r,message:c})},k=d.useMemo(()=>{const r={all:i.length,info:0,success:0,warning:0,error:0};return i.forEach(c=>{const b=w(c.event_type);r[b]+=1}),r},[i]),h=d.useMemo(()=>s==="all"?i:i.filter(r=>w(r.event_type)===s),[i,s]),y=Math.max(1,Math.ceil(h.length/N)),p=d.useMemo(()=>{const r=(a-1)*N;return h.slice(r,r+N)},[h,a]),P=()=>t.invalidateQueries({queryKey:["system-logs"]}),v=q({mutationFn:E.clearEvents,onSuccess:()=>{P(),x(1),C("success","All events cleared")},onError:()=>C("error","Failed to clear events")}),_=()=>{i.length!==0&&window.confirm("Clear all system events? This cannot be undone.")&&v.mutate()},z=r=>{x(c=>{const b=c+r;return b<1||b>y?c:b})},B=n.dataUpdatedAt?new Date(n.dataUpdatedAt).toLocaleTimeString():"—";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Q,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"System Logs"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Inspect miner activity, automation outcomes, and integration events without leaving the new dashboard."})]}),e.jsxs(H,{className:"border-border/60 bg-muted/5",children:[e.jsxs(K,{className:"space-y-4",children:[m&&e.jsx(te,{tone:m.tone,message:m.message}),e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx(O,{className:"text-lg",children:"Recent Events"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(ae,{checked:l,onCheckedChange:g}),e.jsxs(f,{variant:"secondary",size:"sm",onClick:()=>void n.refetch(),disabled:n.isFetching,children:[n.isFetching?e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(G,{className:"mr-2 h-4 w-4"}),"Refresh"]}),e.jsxs(f,{variant:"destructive",size:"sm",onClick:_,disabled:i.length===0||v.isPending,children:[v.isPending?e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(J,{className:"mr-2 h-4 w-4"}),"Clear all"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-muted-foreground sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("span",{children:["Showing ",p.length," of ",h.length," events · Last updated ",B]}),e.jsx("span",{children:"Auto-refresh every 30s when enabled"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-3 lg:grid-cols-5",children:Y.map(r=>{const c=r.value!=="all"&&k[r.value]===0;return e.jsxs("button",{type:"button",onClick:()=>o(r.value),className:u("rounded-xl border border-border/60 bg-background/60 px-4 py-3 text-left transition",s===r.value&&"border-blue-500/80 bg-blue-500/10 shadow-inner",c&&"opacity-60"),children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:r.label}),e.jsx("div",{className:"text-2xl font-semibold text-foreground",children:k[r.value]})]},r.value)})})]}),e.jsxs(U,{className:"space-y-6",children:[n.isLoading&&e.jsx(ee,{}),n.isError&&e.jsx(re,{onRetry:()=>void n.refetch(),message:"Failed to load events."}),!n.isLoading&&!n.isError&&p.length===0&&e.jsx(se,{}),!n.isLoading&&!n.isError&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx(X,{events:p})}),e.jsx("div",{className:"space-y-3 lg:hidden",children:p.map(r=>e.jsx(Z,{event:r},r.id))})]}),y>1&&e.jsx($,{currentPage:a,totalPages:y,totalEvents:h.length,onPageChange:z})]})]})]})}function w(t){const s=(t||"").toLowerCase();return s.includes("error")?"error":s.includes("warning")?"warning":s.includes("success")?"success":"info"}function L(t){var a;const s=t.data??{},o=["miner_name","miner","target","source"];for(const x of o){const l=s[x];if(typeof l=="string"&&l.trim())return l.trim()}return(a=t.source)!=null&&a.startsWith("miner:")?t.source.split(":")[1]||"Miner":t.source||"System"}function F(t){const s=new Date(t);return Number.isNaN(s.getTime())?t:s.toLocaleString()}function X({events:t}){return e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border/60",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/10 text-xs uppercase tracking-wide text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Source"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Event"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Details"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-t border-border/50",children:[e.jsx("td",{className:"px-4 py-3 align-top text-muted-foreground",children:F(s.timestamp)}),e.jsx("td",{className:"px-4 py-3 align-top text-foreground",children:L(s)}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsx(R,{eventType:s.event_type})}),e.jsxs("td",{className:"px-4 py-3 align-top text-sm text-muted-foreground",children:[e.jsx("p",{className:"whitespace-pre-line text-foreground",children:s.message}),e.jsx(M,{data:s.data})]})]},s.id))})]})})}function Z({event:t}){return e.jsxs("div",{className:"rounded-2xl border border-border/60 bg-background/60 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:L(t)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F(t.timestamp)})]}),e.jsx(R,{eventType:t.event_type})]}),e.jsx("p",{className:"mt-3 text-sm text-foreground",children:t.message}),e.jsx(M,{data:t.data})]})}function R({eventType:t}){const s=w(t),o=s==="error"?"bg-red-500/20 text-red-200":s==="warning"?"bg-amber-500/20 text-amber-200":s==="success"?"bg-emerald-500/20 text-emerald-200":"bg-blue-500/20 text-blue-200",a=W(t||s);return e.jsx("span",{className:u("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold capitalize",o),children:a})}function $({currentPage:t,totalPages:s,totalEvents:o,onPageChange:a}){return e.jsxs("div",{className:"flex flex-col gap-3 border-t border-border/40 pt-4 text-sm text-muted-foreground sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("span",{children:["Page ",t," of ",s," · ",o," event",o===1?"":"s"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>a(-1),disabled:t===1,children:"Previous"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>a(1),disabled:t===s,children:"Next"})]})]})}function ee(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted/20"},s))})}function se(){return e.jsxs("div",{className:"rounded-2xl border border-dashed border-border/60 bg-background/40 p-6 text-center",children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:"No events yet"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"When miners change pools, automations fire, or integrations respond, entries will appear here."})]})}function te({tone:t,message:s}){const o=t==="success"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-100":"border-red-500/40 bg-red-500/10 text-red-100",a=t==="success"?V:A;return e.jsxs("div",{className:u("flex items-center gap-2 rounded-2xl border px-4 py-2 text-sm",o),children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})}function M({data:t}){const[s,o]=d.useState(!1),[a,x]=d.useState(!1);if(!t)return null;const l={...t},g=typeof l.traceback=="string"?l.traceback:null,m=!!l.traceback_truncated;"traceback"in l&&delete l.traceback;const j=JSON.stringify(l,null,2);return e.jsxs("div",{className:"mt-3 rounded-xl border border-border/40 bg-muted/10",children:[g&&e.jsxs("div",{className:"border-b border-border/40",children:[e.jsxs("button",{type:"button",onClick:()=>x(n=>!n),className:"flex w-full items-center justify-between px-3 py-2 text-xs font-semibold uppercase tracking-wide text-red-200","aria-expanded":a,children:[e.jsx("span",{children:a?"Hide traceback":"Show traceback"}),e.jsx(S,{className:u("h-4 w-4 transition-transform",a&&"rotate-180")})]}),a&&e.jsxs("div",{className:"border-t border-border/40 px-3 py-2 text-xs text-red-100",children:[m&&e.jsx("div",{className:"mb-2 text-yellow-300",children:"Traceback truncated"}),e.jsx("pre",{className:"max-h-72 overflow-auto whitespace-pre-wrap",children:g})]})]}),e.jsxs("button",{type:"button",onClick:()=>o(n=>!n),className:"flex w-full items-center justify-between px-3 py-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground","aria-expanded":s,children:[e.jsx("span",{children:s?"Hide payload":"Show payload"}),e.jsx(S,{className:u("h-4 w-4 transition-transform",s&&"rotate-180")})]}),s&&e.jsx("pre",{className:"max-h-64 overflow-auto border-t border-border/40 px-3 py-2 text-xs text-muted-foreground",children:j})]})}function re({message:t,onRetry:s}){return e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-red-500/50 bg-red-500/10 px-4 py-3 text-sm text-red-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:t})]}),e.jsx(f,{variant:"secondary",size:"sm",onClick:s,children:"Retry"})]})}function ae({checked:t,onCheckedChange:s}){return e.jsxs("button",{type:"button",onClick:()=>s(!t),className:u("relative inline-flex items-center rounded-full border border-border/70 bg-gray-800 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-muted-foreground transition",t&&"border-emerald-400/70 bg-emerald-500/10 text-emerald-100"),children:[e.jsx("span",{className:u("mr-2 inline-flex h-5 w-5 items-center justify-center rounded-full border border-border/50 bg-background text-[10px] font-bold",t&&"border-emerald-400/70 text-emerald-200"),children:t?"ON":"OFF"}),"Auto-refresh"]})}export{xe as default};
