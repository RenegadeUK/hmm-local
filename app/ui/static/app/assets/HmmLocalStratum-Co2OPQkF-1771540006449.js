import{m as Se,r as w,a as M,n as Fe,j as e,o as Ae,W as ge,C as _,d as f,e as v,f as y,L as Ce,R as Me,a1 as L,a2 as Ne}from"./index-B4KL4pFw-1771540006449.js";import{C as qe}from"./check-circle-2-Dz3CnYSl-1771540006449.js";import{A as Te}from"./alert-triangle-yqhS2KQ--1771540006449.js";const Le="hmm_local_stratum";function $e(a){return typeof a!="number"||!Number.isFinite(a)?"N/A":`${a.toFixed(2)}%`}function l(a){return typeof a!="number"||!Number.isFinite(a)?"N/A":new Intl.NumberFormat().format(a)}function De(a){return typeof a!="number"||!Number.isFinite(a)?"N/A":a>=1024?`${(a/1024).toFixed(2)} GB`:`${a.toFixed(1)} MB`}function je(a){if(!a)return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const c=new Date(a).getTime();if(Number.isNaN(c))return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const p=Math.max(0,Math.floor((Date.now()-c)/1e3));return p<=60?{label:"Fresh",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}:p<=180?{label:"Aging",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Stale",className:"border-red-700/60 bg-red-900/30 text-red-300"}}function Re(a){return typeof a!="number"||!Number.isFinite(a)?{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"}:a>=5?{label:"High",className:"border-red-700/60 bg-red-900/30 text-red-300"}:a>=3?{label:"Elevated",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Normal",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}}function F(a){if(!a)return"Unknown";const c=new Date(a).getTime();if(Number.isNaN(c))return a;const p=Math.max(0,Math.floor((Date.now()-c)/1e3));if(p<60)return`${p}s ago`;const g=Math.floor(p/60);if(g<60)return`${g}m ago`;const N=Math.floor(g/60);return N<24?`${N}h ago`:`${Math.floor(N/24)}d ago`}function Ue(a){if(!a)return"Unknown";const c=new Date(a);return Number.isNaN(c.getTime())?a:c.toISOString().replace("T"," ").replace(".000Z","Z")}function _e(a,c=8){return a?a.length<=c*2+3?a:`${a.slice(0,c)}...${a.slice(-c)}`:"N/A"}function Ie(a){if(a.accepted_by_node)return{label:"Accepted",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"};const c=String(a.reject_category||"").toLowerCase();return c.includes("invalid")||c.includes("bad")||c.includes("rpc_error")?{label:"Rejected",className:"border-red-700/60 bg-red-900/30 text-red-300"}:{label:"Inconclusive",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}}function Oe(){var R,U,I,W,E,Q,O,K,P,B,z,G,V;const a=Se(),[c,p]=w.useState(!1),[g,N]=w.useState(null),k=M({queryKey:["integrations","hmm-local-stratum","settings"],queryFn:()=>L.getHmmLocalStratumSettings(),staleTime:3e4});w.useEffect(()=>{var t;typeof((t=k.data)==null?void 0:t.enabled)=="boolean"&&p(k.data.enabled)},[(R=k.data)==null?void 0:R.enabled]);const q=Fe({mutationFn:()=>L.saveHmmLocalStratumSettings(c),onSuccess:t=>{N({tone:"success",message:t.message||"Settings saved"}),a.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),a.invalidateQueries({queryKey:["layout","stratum-dashboards-enabled"]}),setTimeout(()=>N(null),3500)},onError:t=>{N({tone:"error",message:t.message||"Failed to save settings"}),setTimeout(()=>N(null),3500)}}),T=M({queryKey:["integrations","hmm-local-stratum","tiles"],queryFn:()=>Ne.getPoolTiles(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),D=M({queryKey:["integrations","hmm-local-stratum","recovery-status"],queryFn:()=>Ne.getRecoveryStatus(24),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),A=M({queryKey:["integrations","hmm-local-stratum","operational"],queryFn:()=>L.getHmmLocalStratumOperational(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),u=M({queryKey:["integrations","hmm-local-stratum","candidate-incidents"],queryFn:()=>L.getHmmLocalStratumCandidateIncidents(24,50),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),j=w.useMemo(()=>Object.values(T.data||{}).filter(t=>t.pool_type===Le),[T.data]),$=w.useMemo(()=>{var h;const t=new Map;for(const x of((h=D.data)==null?void 0:h.pools)||[])t.set(String(x.pool_id),x);return t},[(U=D.data)==null?void 0:U.pools]),fe=w.useMemo(()=>{var h,x,d;const t=new Map;for(const s of((h=A.data)==null?void 0:h.pools)||[])((x=s.pool)==null?void 0:x.id)!==null&&((d=s.pool)==null?void 0:d.id)!==void 0&&t.set(String(s.pool.id),s);return t},[(I=A.data)==null?void 0:I.pools]),C=w.useMemo(()=>{const t=j.filter(s=>s.tile_1_health.health_status===!1).length,h=j.reduce((s,i)=>{const n=$.get(String(i.pool_id));return s.recovered+=(n==null?void 0:n.recovered_count)||0,s.unresolved+=(n==null?void 0:n.unresolved_count)||0,s},{recovered:0,unresolved:0}),x=j.filter(s=>je(s.last_updated).label==="Stale").length,d=j.reduce((s,i)=>{var n;return s+(((n=i.warnings)==null?void 0:n.length)||0)},0);return{unhealthyPools:t,staleFeeds:x,driverWarnings:d,recovered:h.recovered,unresolved:h.unresolved}},[$,j]);return T.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ae,{className:"h-8 w-8 animate-spin text-blue-500"})}):T.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(ge,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load Stratum operational data."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(ge,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Dedicated operational status view for local Stratum integration pools."})]}),g&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${g.tone==="success"?"border-emerald-700/60 bg-emerald-900/30 text-emerald-200":g.tone==="error"?"border-red-700/60 bg-red-900/30 text-red-200":"border-blue-700/60 bg-blue-900/30 text-blue-200"}`,children:g.message}),e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(v,{children:"HMM-Local Stratum dashboards"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:c,onChange:t=>p(t.target.checked),disabled:k.isLoading||q.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable dedicated HMM-Local Stratum dashboards"}),e.jsx("div",{className:"text-xs text-slate-400",children:"When enabled, a new top-level navigation section appears with BTC, BCH and DGB pages focused on mining pool data."})]})]}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-blue-700/60 bg-blue-900/30 px-3 py-2 text-sm text-blue-200 hover:bg-blue-900/40 disabled:opacity-50",onClick:()=>q.mutate(),disabled:q.isPending||k.isLoading,children:q.isPending?"Saving…":"Save setting"})]})]}),j.length===0?e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(v,{children:"No HMM-Local Stratum pool configured"})}),e.jsxs(y,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Add or update a pool with driver ",e.jsx("span",{className:"font-semibold text-foreground",children:"hmm_local_stratum"})," to populate this page."]}),e.jsx("div",{children:e.jsx(Ce,{className:"text-blue-400 hover:text-blue-300 underline",to:"/pools",children:"Go to Pools"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(_,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm text-muted-foreground",children:"Configured pools"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:j.length}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[C.unhealthyPools," degraded"]})]})]}),e.jsxs(_,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm text-muted-foreground",children:"Data freshness risk"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:C.staleFeeds}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Stale feeds (> 3m old)"})]})]}),e.jsxs(_,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm text-muted-foreground",children:"Driver warnings"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:C.driverWarnings}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Unresolved / not-loaded flags"})]})]}),e.jsxs(_,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm text-muted-foreground",children:"Driver recoveries (24h)"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:C.recovered}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[C.unresolved," unresolved"]})]})]})]}),e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(v,{children:"Candidate incidents (24h)"})}),e.jsx(y,{className:"space-y-4",children:u.isLoading?e.jsx("div",{className:"text-sm text-slate-300",children:"Loading candidate incidents…"}):u.isError?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-sm text-amber-300",children:["Failed to load candidate incidents: ",((W=u.error)==null?void 0:W.message)||"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Accepted: ",((E=u.data)==null?void 0:E.summary.accepted)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rejected: ",((Q=u.data)==null?void 0:Q.summary.rejected)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rows: ",((O=u.data)==null?void 0:O.count)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-400",children:["Updated ",F(((K=u.data)==null?void 0:K.fetched_at)||null)]})]}),(((B=(P=u.data)==null?void 0:P.fetch_errors)==null?void 0:B.length)||0)>0&&e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:"Some Stratum endpoints were unavailable. Showing partial results."}),(((G=(z=u.data)==null?void 0:z.rows)==null?void 0:G.length)||0)===0?e.jsx("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 text-sm text-slate-300",children:"No candidate incidents in the last 24 hours."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700/60",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-slate-900/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-medium",children:"Time (UTC)"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Coin"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Worker"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Job"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Template"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Block"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Result"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Category"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Latency"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Variant"})]})}),e.jsx("tbody",{children:(((V=u.data)==null?void 0:V.rows)||[]).map(t=>{const h=Ie(t);return e.jsxs("tr",{className:"border-t border-slate-800/70 text-slate-200",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Ue(t.ts)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.coin||"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.worker||"",children:_e(t.worker,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.job_id||"N/A"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.template_height??"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.block_hash||"",children:_e(t.block_hash,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 ${h.className}`,children:h.label})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.reject_category||"accepted"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:typeof t.latency_ms=="number"?`${t.latency_ms.toFixed(2)} ms`:"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.matched_variant||"",children:t.matched_variant||"N/A"})]},`${t.ts}-${t.coin}-${t.job_id||"no-job"}`)})})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:j.map(t=>{var ae,le,re,de,ie,ne,ce,xe,oe,me,he,ue,pe;const h=String(t.pool_id),x=$.get(h),d=fe.get(h),s=(ae=d==null?void 0:d.stats)==null?void 0:ae.datastore,i=d==null?void 0:d.database,n=i==null?void 0:i.pool,b=i==null?void 0:i.postgresql,o=(le=i==null?void 0:i.high_water_marks)==null?void 0:le.last_24h,m=(re=i==null?void 0:i.high_water_marks)==null?void 0:re.since_boot,S=String(t.tile_4_blocks.currency||"").toUpperCase(),r=S?(ie=(de=d==null?void 0:d.stats)==null?void 0:de.coins)==null?void 0:ie[S]:void 0,Z=Number((s==null?void 0:s.total_write_batches_ok)||0),ve=Number((s==null?void 0:s.total_write_batches_failed)||0),J=Z+ve,Y=J>0?Z/J*100:null,X=Number((r==null?void 0:r.shares_accepted)||0),ye=Number((r==null?void 0:r.shares_rejected)||0),H=X+ye,ee=H>0?X/H*100:null,we=Number((r==null?void 0:r.block_candidates)||0),ke=Number((r==null?void 0:r.blocks_rejected)||0),se=je(t.last_updated),te=Re(t.tile_3_shares.reject_rate);return e.jsxs(_,{children:[e.jsxs(f,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(v,{className:"text-lg",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/60 px-2 py-1 text-slate-300",children:[e.jsx(Me,{className:"h-3 w-3"})," Updated ",F(t.last_updated)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-1 ${se.className}`,children:["Feed ",se.label]}),t.tile_1_health.health_status?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(qe,{className:"h-3 w-3"})," Healthy"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-amber-300",children:[e.jsx(Te,{className:"h-3 w-3"})," Degraded"]})]})]}),(t.warnings||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.warnings||[]).map(be=>e.jsx("span",{className:"inline-flex rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-xs text-amber-300",children:be},`${t.pool_id}-${be}`))})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Service health"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:t.tile_1_health.health_message||"No message"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Latency: ",t.tile_1_health.latency_ms??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Operational info (/stats)"}),A.isLoading?e.jsx("div",{className:"mt-1 text-sm text-slate-300",children:"Loading operational stats…"}):A.isError?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:((ne=A.error)==null?void 0:ne.message)||"Operational query failed"})]}):(d==null?void 0:d.status)!=="ok"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:(d==null?void 0:d.error)||"No response from Stratum API"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Queue: ",l(s==null?void 0:s.queue_depth)," / max seen ",l(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Rows written: ",l(s==null?void 0:s.total_rows_written)," · Dropped: ",l(s==null?void 0:s.total_dropped)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Batches ok/fail: ",l(s==null?void 0:s.total_write_batches_ok)," / ",l(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Enqueued: ",l(s==null?void 0:s.total_enqueued)," · Spooled/Replayed: ",l(s==null?void 0:s.total_spooled_rows)," / ",l(s==null?void 0:s.total_replayed_rows)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retries: ",l(s==null?void 0:s.total_retries)," · Consecutive failures: ",l(s==null?void 0:s.consecutive_write_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last write: ",F((s==null?void 0:s.last_write_ok_at)||null)," · Latency: ",((ce=s==null?void 0:s.last_write_latency_ms)==null?void 0:ce.toFixed(2))??"N/A"," ms"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["DB: ",(xe=d.stats)!=null&&xe.db_enabled?"enabled":"disabled"," · Datastore: ",s!=null&&s.enabled?"enabled":"disabled"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retention (d): H ",l(s==null?void 0:s.hashrate_retention_days)," · N ",l(s==null?void 0:s.network_retention_days)," · K ",l(s==null?void 0:s.kpi_retention_days)]}),(s==null?void 0:s.spool_path)&&e.jsxs("div",{className:"truncate text-xs text-slate-500",title:s.spool_path,children:["Spool path: ",s.spool_path]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Quality / reliability"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${te.className}`,children:["Reject risk: ",te.label]})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Reject rate: ",$e(t.tile_3_shares.reject_rate)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid ",t.tile_3_shares.shares_valid??"N/A"," · Invalid ",t.tile_3_shares.shares_invalid??"N/A"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Driver recovery (24h)"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Recovered: ",(x==null?void 0:x.recovered_count)||0]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Unresolved: ",(x==null?void 0:x.unresolved_count)||0]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last event: ",x!=null&&x.last_event_at?F(x.last_event_at):"None"]})]})]}),(d==null?void 0:d.status)==="ok"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Queue pressure"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:l(s==null?void 0:s.queue_depth)}),e.jsxs("div",{className:"text-xs text-slate-400",children:["max seen ",l(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["dropped ",l(s==null?void 0:s.total_dropped)," · retries ",l(s==null?void 0:s.total_retries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Write reliability"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:Y!==null?`${Y.toFixed(1)}%`:"N/A"}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ok/fail ",l(s==null?void 0:s.total_write_batches_ok)," / ",l(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["last write ",F((s==null?void 0:s.last_write_ok_at)||null)," · ",((oe=s==null?void 0:s.last_write_latency_ms)==null?void 0:oe.toFixed(1))??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Share pipeline",S?` (${S})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:ee!==null?`${ee.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-xs text-slate-400",children:"accept rate"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["accepted ",l(r==null?void 0:r.shares_accepted)," · rejected ",l(r==null?void 0:r.shares_rejected)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["workers ",l(r==null?void 0:r.connected_workers)," · last share ",F((r==null?void 0:r.last_share_at)||null)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Block pipeline",S?` (${S})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:l(r==null?void 0:r.blocks_accepted)}),e.jsx("div",{className:"text-xs text-slate-400",children:"accepted by node"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["candidates ",l(we)," · rejected ",l(ke)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(r==null?void 0:r.last_block_submit_result)||"",children:["last result ",(r==null?void 0:r.last_block_submit_result)||"N/A"]})]})]}),e.jsxs("div",{className:"border-t border-slate-700/60 pt-4",children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-wide text-slate-400",children:"Stratum DB health"}),(d==null?void 0:d.database_status)!=="ok"?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:["Unavailable: ",(d==null?void 0:d.database_error)||"No DB health response"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Connection Pool"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-xl font-semibold text-slate-100",children:[((me=n==null?void 0:n.utilization_percent)==null?void 0:me.toFixed(1))??"N/A","%"]}),e.jsx("span",{className:"text-xs text-slate-400",children:"utilized"})]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:[l(n==null?void 0:n.checked_out),"/",l(n==null?void 0:n.total_capacity)," (",l((n==null?void 0:n.max_capacity_configured)??(n==null?void 0:n.total_capacity))," max)"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Active Queries"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:l(b==null?void 0:b.active_connections)}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Slow (>1m): ",l(b==null?void 0:b.long_running_queries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Database Size"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:De(b==null?void 0:b.database_size_mb)}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:"total storage"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Health Status"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${(i==null?void 0:i.status)==="healthy"?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":(i==null?void 0:i.status)==="warning"?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-red-700/60 bg-red-900/30 text-red-300"}`,children:((i==null?void 0:i.status)||"unknown").toUpperCase()})})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"High-water marks (last 24h)"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Since ",((he=i==null?void 0:i.high_water_marks)==null?void 0:he.last_24h_date)||"N/A"]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-300",children:[e.jsxs("div",{children:["Pool peak: ",l(o==null?void 0:o.db_pool_in_use_peak)]}),e.jsxs("div",{children:["Active peak: ",l(o==null?void 0:o.active_queries_peak)]}),e.jsxs("div",{children:["Wait count: ",l(o==null?void 0:o.db_pool_wait_count)]}),e.jsxs("div",{children:["Wait sec: ",((ue=o==null?void 0:o.db_pool_wait_seconds_sum)==null?void 0:ue.toFixed(1))??"N/A","s"]}),e.jsxs("div",{children:["Slow queries: ",l(o==null?void 0:o.slow_queries_peak)]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"High-water marks (since boot)"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-300",children:[e.jsxs("div",{children:["Pool peak: ",l(m==null?void 0:m.db_pool_in_use_peak)]}),e.jsxs("div",{children:["Active peak: ",l(m==null?void 0:m.active_queries_peak)]}),e.jsxs("div",{children:["Wait count: ",l(m==null?void 0:m.db_pool_wait_count)]}),e.jsxs("div",{children:["Wait sec: ",((pe=m==null?void 0:m.db_pool_wait_seconds_sum)==null?void 0:pe.toFixed(1))??"N/A","s"]}),e.jsxs("div",{children:["Slow queries: ",l(m==null?void 0:m.slow_queries_peak)]})]})]})]})]})]})]})]},t.pool_id)})})]})]})}export{Oe as default};
