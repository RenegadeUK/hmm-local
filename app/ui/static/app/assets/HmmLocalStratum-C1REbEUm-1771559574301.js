import{m as ns,r as b,a as D,n as cs,j as e,o as Ve,W as Je,C as k,d as S,e as A,f as F,L as os,R as xs,T as ms,a1 as I,a2 as Ye}from"./index-BO2JGz_s-1771559574301.js";import{C as us}from"./check-circle-2-Cm1lJbqV-1771559574301.js";import{A as hs}from"./alert-triangle-DncO3rg7-1771559574301.js";import{Z as bs}from"./zap-NfR654FM-1771559574301.js";import{H as ps}from"./hard-drive-BedPrCGs-1771559574301.js";const Xe="hmm_local_stratum";function gs(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":`${d.toFixed(2)}%`}function r(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":new Intl.NumberFormat().format(d)}function js(d){return typeof d!="number"||!Number.isFinite(d)?"N/A":d>=1024?`${(d/1024).toFixed(2)} GB`:`${d.toFixed(1)} MB`}function Ge(d){if(!d)return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const u=new Date(d).getTime();if(Number.isNaN(u))return{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"};const y=Math.max(0,Math.floor((Date.now()-u)/1e3));return y<=60?{label:"Fresh",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}:y<=180?{label:"Aging",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Stale",className:"border-red-700/60 bg-red-900/30 text-red-300"}}function Ns(d){return typeof d!="number"||!Number.isFinite(d)?{label:"Unknown",className:"border-slate-700/50 bg-slate-900/30 text-slate-300"}:d>=5?{label:"High",className:"border-red-700/60 bg-red-900/30 text-red-300"}:d>=3?{label:"Elevated",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}:{label:"Normal",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"}}function $(d){if(!d)return"Unknown";const u=new Date(d).getTime();if(Number.isNaN(u))return d;const y=Math.max(0,Math.floor((Date.now()-u)/1e3));if(y<60)return`${y}s ago`;const N=Math.floor(y/60);if(N<60)return`${N}m ago`;const C=Math.floor(N/60);return C<24?`${C}h ago`:`${Math.floor(C/24)}d ago`}function fs(d){if(!d)return"Unknown";const u=new Date(d);return Number.isNaN(u.getTime())?d:u.toISOString().replace("T"," ").replace(".000Z","Z")}function He(d,u=8){return d?d.length<=u*2+3?d:`${d.slice(0,u)}...${d.slice(-u)}`:"N/A"}function vs(d){if(d.accepted_by_node)return{label:"Accepted",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"};const u=String(d.reject_category||"").toLowerCase();return u.includes("invalid")||u.includes("bad")||u.includes("rpc_error")?{label:"Rejected",className:"border-red-700/60 bg-red-900/30 text-red-300"}:{label:"Inconclusive",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}}function As(){var se,te,ae,le,re,de,ie,ne,ce,oe,xe,me,ue,he;const d=ns(),[u,y]=b.useState(!1),[N,C]=b.useState(!1),[U,W]=b.useState(null),[Z,V]=b.useState(!0),[J,Y]=b.useState(!0),[E,X]=b.useState(!1),[O,G]=b.useState(!0),[H,ee]=b.useState(5),[R,P]=b.useState(null),c=D({queryKey:["integrations","hmm-local-stratum","settings"],queryFn:()=>I.getHmmLocalStratumSettings(),staleTime:3e4});b.useEffect(()=>{var t,n,h,o,l,s,a,x,j;typeof((t=c.data)==null?void 0:t.enabled)=="boolean"&&y(c.data.enabled),typeof((n=c.data)==null?void 0:n.failover_enabled)=="boolean"&&C(c.data.failover_enabled),((h=c.data)==null?void 0:h.backup_pool_id)===null||((o=c.data)==null?void 0:o.backup_pool_id)===void 0?W(null):W(Number(c.data.backup_pool_id)),typeof((l=c.data)==null?void 0:l.local_stratum_enabled)=="boolean"&&V(c.data.local_stratum_enabled),typeof((s=c.data)==null?void 0:s.hard_lock_enabled)=="boolean"&&Y(c.data.hard_lock_enabled),typeof((a=c.data)==null?void 0:a.hard_lock_active)=="boolean"&&X(c.data.hard_lock_active),typeof((x=c.data)==null?void 0:x.auto_return_enabled)=="boolean"&&G(c.data.auto_return_enabled),typeof((j=c.data)==null?void 0:j.auto_return_minutes)=="number"&&ee(Math.max(1,c.data.auto_return_minutes))},[c.data]);const f=cs({mutationFn:()=>I.saveHmmLocalStratumSettings({enabled:u,failover_enabled:N,backup_pool_id:U,local_stratum_enabled:Z,hard_lock_enabled:J,hard_lock_active:E,auto_return_enabled:O,auto_return_minutes:H}),onSuccess:t=>{P({tone:"success",message:t.message||"Settings saved"}),d.invalidateQueries({queryKey:["integrations","hmm-local-stratum","settings"]}),d.invalidateQueries({queryKey:["layout","stratum-dashboards-enabled"]}),setTimeout(()=>P(null),3500)},onError:t=>{P({tone:"error",message:t.message||"Failed to save settings"}),setTimeout(()=>P(null),3500)}}),L=D({queryKey:["integrations","hmm-local-stratum","tiles"],queryFn:()=>Ye.getPoolTiles(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),M=D({queryKey:["integrations","hmm-local-stratum","recovery-status"],queryFn:()=>Ye.getRecoveryStatus(24),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),w=D({queryKey:["integrations","hmm-local-stratum","operational"],queryFn:()=>I.getHmmLocalStratumOperational(),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),v=D({queryKey:["integrations","hmm-local-stratum","candidate-incidents"],queryFn:()=>I.getHmmLocalStratumCandidateIncidents(24,50),refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),_=b.useMemo(()=>Object.values(L.data||{}).filter(t=>t.pool_type===Xe),[L.data]),es=b.useMemo(()=>Object.values(L.data||{}).filter(t=>t.pool_type!==Xe).sort((t,n)=>t.display_name.localeCompare(n.display_name)),[L.data]),Q=b.useMemo(()=>{var n;const t=new Map;for(const h of((n=M.data)==null?void 0:n.pools)||[])t.set(String(h.pool_id),h);return t},[(se=M.data)==null?void 0:se.pools]),ss=b.useMemo(()=>{var n;const t=new Map;for(const h of((n=M.data)==null?void 0:n.pools)||[]){const o=String(h.pool_name||"").trim().toLowerCase();o&&t.set(o,h)}return t},[(te=M.data)==null?void 0:te.pools]),ts=b.useMemo(()=>{var n,h,o;const t=new Map;for(const l of((n=w.data)==null?void 0:n.pools)||[])((h=l.pool)==null?void 0:h.id)!==null&&((o=l.pool)==null?void 0:o.id)!==void 0&&t.set(String(l.pool.id),l);return t},[(ae=w.data)==null?void 0:ae.pools]),as=b.useMemo(()=>{var n,h;const t=new Map;for(const o of((n=w.data)==null?void 0:n.pools)||[]){const l=String(((h=o.pool)==null?void 0:h.name)||"").trim().toLowerCase();l&&t.set(l,o)}return t},[(le=w.data)==null?void 0:le.pools]),T=b.useMemo(()=>{const t=_.filter(l=>l.tile_1_health.health_status===!1).length,n=_.reduce((l,s)=>{const a=Q.get(String(s.pool_id));return l.recovered+=(a==null?void 0:a.recovered_count)||0,l.unresolved+=(a==null?void 0:a.unresolved_count)||0,l},{recovered:0,unresolved:0}),h=_.filter(l=>Ge(l.last_updated).label==="Stale").length,o=_.reduce((l,s)=>{var a;return l+(((a=s.warnings)==null?void 0:a.length)||0)},0);return{unhealthyPools:t,staleFeeds:h,driverWarnings:o,recovered:n.recovered,unresolved:n.unresolved}},[Q,_]);return L.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ve,{className:"h-8 w-8 animate-spin text-blue-500"})}):L.isError?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Je,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load Stratum operational data."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(Je,{className:"h-8 w-8 text-blue-400"}),e.jsx("span",{children:"HMM-Local Stratum"})]}),e.jsx("p",{className:"text-base text-muted-foreground",children:"Dedicated operational status view for local Stratum integration pools."})]}),R&&e.jsx("div",{className:`rounded-lg border px-4 py-3 text-sm ${R.tone==="success"?"border-emerald-700/60 bg-emerald-900/30 text-emerald-200":R.tone==="error"?"border-red-700/60 bg-red-900/30 text-red-200":"border-blue-700/60 bg-blue-900/30 text-blue-200"}`,children:R.message}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(A,{children:"HMM-Local Stratum dashboards"})}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:u,onChange:t=>y(t.target.checked),disabled:c.isLoading||f.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable dedicated HMM-Local Stratum dashboards"}),e.jsx("div",{className:"text-xs text-slate-400",children:"When enabled, a new top-level navigation section appears with BTC, BCH and DGB pages focused on mining pool data."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:N,onChange:t=>C(t.target.checked),disabled:c.isLoading||f.isPending}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable strategy backup-pool failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Strategy-managed miners fail over to a backup pool when local stratum is marked unavailable."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Backup pool"}),e.jsxs("select",{className:"mt-2 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100",value:U??"",onChange:t=>{const n=t.target.value;W(n?Number(n):null)},disabled:c.isLoading||f.isPending||!N,children:[e.jsx("option",{value:"",children:"Select backup pool"}),es.map(t=>e.jsx("option",{value:t.pool_id,children:t.display_name},t.pool_id))]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:Z,onChange:t=>V(t.target.checked),disabled:c.isLoading||f.isPending||!N}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Local stratum currently available"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Disable this to route strategy miners to backup pool."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:J,onChange:t=>Y(t.target.checked),disabled:c.isLoading||f.isPending||!N}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable hard-lock on failover"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Keep miners on backup until you clear hard-lock manually."})]})]}),e.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4",checked:O,onChange:t=>G(t.target.checked),disabled:c.isLoading||f.isPending||!N}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Enable automatic return"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Clear hard-lock and return to primary after local stratum stays healthy."})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-slate-100",children:"Auto-return healthy window (minutes)"}),e.jsx("input",{type:"number",min:1,className:"mt-2 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100",value:H,onChange:t=>ee(Math.max(1,Number(t.target.value)||1)),disabled:c.isLoading||f.isPending||!N||!O})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-200",children:"Hard-lock status"}),e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${E?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-emerald-700/60 bg-emerald-900/30 text-emerald-300"}`,children:E?"Active":"Inactive"})]}),E&&e.jsx("button",{type:"button",className:"mt-3 inline-flex items-center rounded-md border border-amber-700/60 bg-amber-900/30 px-3 py-2 text-xs text-amber-200 hover:bg-amber-900/40 disabled:opacity-50",onClick:()=>X(!1),disabled:c.isLoading||f.isPending,children:"Resume primary (clear hard-lock)"})]}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-blue-700/60 bg-blue-900/30 px-3 py-2 text-sm text-blue-200 hover:bg-blue-900/40 disabled:opacity-50",onClick:()=>f.mutate(),disabled:f.isPending||c.isLoading,children:f.isPending?"Saving…":"Save setting"})]})]}),_.length===0?e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(A,{children:"No HMM-Local Stratum pool configured"})}),e.jsxs(F,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Add or update a pool with driver ",e.jsx("span",{className:"font-semibold text-foreground",children:"hmm_local_stratum"})," to populate this page."]}),e.jsx("div",{children:e.jsx(os,{className:"text-blue-400 hover:text-blue-300 underline",to:"/pools",children:"Go to Pools"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(A,{className:"text-sm text-muted-foreground",children:"Configured pools"})}),e.jsxs(F,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:_.length}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[T.unhealthyPools," degraded"]})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(A,{className:"text-sm text-muted-foreground",children:"Data freshness risk"})}),e.jsxs(F,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.staleFeeds}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Stale feeds (> 3m old)"})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(A,{className:"text-sm text-muted-foreground",children:"Driver warnings"})}),e.jsxs(F,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.driverWarnings}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Unresolved / not-loaded flags"})]})]}),e.jsxs(k,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(A,{className:"text-sm text-muted-foreground",children:"Driver recoveries (24h)"})}),e.jsxs(F,{children:[e.jsx("div",{className:"text-3xl font-semibold",children:T.recovered}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[T.unresolved," unresolved"]})]})]})]}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsx(A,{children:"Candidate incidents (24h)"})}),e.jsx(F,{className:"space-y-4",children:v.isLoading?e.jsx("div",{className:"text-sm text-slate-300",children:"Loading candidate incidents…"}):v.isError?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-sm text-amber-300",children:["Failed to load candidate incidents: ",((re=v.error)==null?void 0:re.message)||"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Accepted: ",((de=v.data)==null?void 0:de.summary.accepted)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rejected: ",((ie=v.data)==null?void 0:ie.summary.rejected)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rows: ",((ne=v.data)==null?void 0:ne.count)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-400",children:["Updated ",$(((ce=v.data)==null?void 0:ce.fetched_at)||null)]})]}),(((xe=(oe=v.data)==null?void 0:oe.fetch_errors)==null?void 0:xe.length)||0)>0&&e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:"Some Stratum endpoints were unavailable. Showing partial results."}),(((ue=(me=v.data)==null?void 0:me.rows)==null?void 0:ue.length)||0)===0?e.jsx("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 text-sm text-slate-300",children:"No candidate incidents in the last 24 hours."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700/60",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-slate-900/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-medium",children:"Time (UTC)"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Coin"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Worker"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Job"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Template"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Block"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Result"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Category"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Latency"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Variant"})]})}),e.jsx("tbody",{children:(((he=v.data)==null?void 0:he.rows)||[]).map(t=>{const n=vs(t);return e.jsxs("tr",{className:"border-t border-slate-800/70 text-slate-200",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:fs(t.ts)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.coin||"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.worker||"",children:He(t.worker,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.job_id||"N/A"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.template_height??"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.block_hash||"",children:He(t.block_hash,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 ${n.className}`,children:n.label})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.reject_category||"accepted"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:typeof t.latency_ms=="number"?`${t.latency_ms.toFixed(2)} ms`:"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.matched_variant||"",children:t.matched_variant||"N/A"})]},`${t.ts}-${t.coin}-${t.job_id||"no-job"}`)})})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:_.map(t=>{var ke,Se,Ae,Fe,Ce,Le,Me,qe,$e,Te,De,Ee,Re,Pe,Ie,Ue,We,Oe,Qe,Be,Ke,ze;const n=String(t.pool_id||"").trim(),h=String(t.display_name||"").trim().toLowerCase(),o=(n?Q.get(n):void 0)||ss.get(h)||(_.length===1&&(((Se=(ke=M.data)==null?void 0:ke.pools)==null?void 0:Se.length)||0)===1?(Fe=(Ae=M.data)==null?void 0:Ae.pools)==null?void 0:Fe[0]:void 0),l=(n?ts.get(n):void 0)||as.get(h)||(_.length===1&&(((Le=(Ce=w.data)==null?void 0:Ce.pools)==null?void 0:Le.length)||0)===1?(qe=(Me=w.data)==null?void 0:Me.pools)==null?void 0:qe[0]:void 0),s=($e=l==null?void 0:l.stats)==null?void 0:$e.datastore,a=l==null?void 0:l.database,x=a==null?void 0:a.pool,j=a==null?void 0:a.postgresql,p=(Te=a==null?void 0:a.high_water_marks)==null?void 0:Te.last_24h,g=(De=a==null?void 0:a.high_water_marks)==null?void 0:De.since_boot,B=Math.max(0,Math.min(100,Number((x==null?void 0:x.utilization_percent)||0))),q=String(t.tile_4_blocks.currency||"").toUpperCase(),i=q?(Re=(Ee=l==null?void 0:l.stats)==null?void 0:Ee.coins)==null?void 0:Re[q]:void 0,m=(Pe=l==null?void 0:l.stats)==null?void 0:Pe.dgb_proposal_guard,K=Number((m==null?void 0:m.required_consecutive_passes)||25e3),be=Number((m==null?void 0:m.consecutive_passes)||0),pe=K>0?Math.max(0,Math.min(100,be/K*100)):0,z=!!(m!=null&&m.submit_enabled),ge=Number((s==null?void 0:s.total_write_batches_ok)||0),ls=Number((s==null?void 0:s.total_write_batches_failed)||0),je=ge+ls,Ne=je>0?ge/je*100:null,fe=Number((i==null?void 0:i.shares_accepted)||0),rs=Number((i==null?void 0:i.shares_rejected)||0),ve=fe+rs,_e=ve>0?fe/ve*100:null,ds=Number((i==null?void 0:i.block_candidates)||0),is=Number((i==null?void 0:i.blocks_rejected)||0),ye=Ge(t.last_updated),we=Ns(t.tile_3_shares.reject_rate);return e.jsxs(k,{children:[e.jsxs(S,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(A,{className:"text-lg",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900/60 px-2 py-1 text-slate-300",children:[e.jsx(xs,{className:"h-3 w-3"})," Updated ",$(t.last_updated)]}),e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-1 ${ye.className}`,children:["Feed ",ye.label]}),t.tile_1_health.health_status?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(us,{className:"h-3 w-3"})," Healthy"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-amber-300",children:[e.jsx(hs,{className:"h-3 w-3"})," Degraded"]})]})]}),(t.warnings||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(t.warnings||[]).map(Ze=>e.jsx("span",{className:"inline-flex rounded-full border border-amber-700/60 bg-amber-900/30 px-2 py-1 text-xs text-amber-300",children:Ze},`${t.pool_id}-${Ze}`))})]}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Service health"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:t.tile_1_health.health_message||"No message"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Latency: ",t.tile_1_health.latency_ms??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Operational info (/stats)"}),w.isLoading?e.jsx("div",{className:"mt-1 text-sm text-slate-300",children:"Loading operational stats…"}):w.isError?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:((Ie=w.error)==null?void 0:Ie.message)||"Operational query failed"})]}):(l==null?void 0:l.status)!=="ok"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-1 text-sm text-amber-300",children:"Unavailable"}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:(l==null?void 0:l.error)||"No response from Stratum API"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Queue: ",r(s==null?void 0:s.queue_depth)," / max seen ",r(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Rows written: ",r(s==null?void 0:s.total_rows_written)," · Dropped: ",r(s==null?void 0:s.total_dropped)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Batches ok/fail: ",r(s==null?void 0:s.total_write_batches_ok)," / ",r(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Enqueued: ",r(s==null?void 0:s.total_enqueued)," · Spooled/Replayed: ",r(s==null?void 0:s.total_spooled_rows)," / ",r(s==null?void 0:s.total_replayed_rows)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retries: ",r(s==null?void 0:s.total_retries)," · Consecutive failures: ",r(s==null?void 0:s.consecutive_write_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last write: ",$((s==null?void 0:s.last_write_ok_at)||null)," · Latency: ",((Ue=s==null?void 0:s.last_write_latency_ms)==null?void 0:Ue.toFixed(2))??"N/A"," ms"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["DB: ",(We=l.stats)!=null&&We.db_enabled?"enabled":"disabled"," · Datastore: ",s!=null&&s.enabled?"enabled":"disabled"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Retention (d): H ",r(s==null?void 0:s.hashrate_retention_days)," · N ",r(s==null?void 0:s.network_retention_days)," · K ",r(s==null?void 0:s.kpi_retention_days)]}),(s==null?void 0:s.spool_path)&&e.jsxs("div",{className:"truncate text-xs text-slate-500",title:s.spool_path,children:["Spool path: ",s.spool_path]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Quality / reliability"}),e.jsx("div",{className:"mt-1 flex items-center gap-2",children:e.jsxs("span",{className:`inline-flex rounded-full border px-2 py-1 text-xs ${we.className}`,children:["Reject risk: ",we.label]})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Reject rate: ",gs(t.tile_3_shares.reject_rate)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Valid ",t.tile_3_shares.shares_valid??"N/A"," · Invalid ",t.tile_3_shares.shares_invalid??"N/A"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Driver recovery (24h)"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:["Recovered: ",(o==null?void 0:o.recovered_count)||0]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Unresolved: ",(o==null?void 0:o.unresolved_count)||0]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Last event: ",o!=null&&o.last_event_at?$(o.last_event_at):"None"]})]})]}),(l==null?void 0:l.status)==="ok"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Proposal checker (DGB)"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${z?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":"border-amber-700/60 bg-amber-900/30 text-amber-300"}`,children:z?"Enabled":"Disabled"}),e.jsxs("span",{className:"text-xs text-slate-400",children:[pe.toFixed(4),"%"]})]}),e.jsxs("div",{className:"mt-2 text-xl font-semibold text-slate-100",children:[r(be)," / ",r(K)]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${z?"bg-emerald-500":"bg-amber-500"}`,style:{width:`${pe}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["checks ",r(m==null?void 0:m.total_checks)," · fails ",r(m==null?void 0:m.total_failures)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(m==null?void 0:m.last_failure_reason)||"",children:["last failure ",(m==null?void 0:m.last_failure_reason)||"None"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Queue pressure"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(s==null?void 0:s.queue_depth)}),e.jsxs("div",{className:"text-xs text-slate-400",children:["max seen ",r(s==null?void 0:s.max_queue_depth_seen)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["dropped ",r(s==null?void 0:s.total_dropped)," · retries ",r(s==null?void 0:s.total_retries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Write reliability"}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:Ne!==null?`${Ne.toFixed(1)}%`:"N/A"}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ok/fail ",r(s==null?void 0:s.total_write_batches_ok)," / ",r(s==null?void 0:s.total_write_batches_failed)]}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["last write ",$((s==null?void 0:s.last_write_ok_at)||null)," · ",((Oe=s==null?void 0:s.last_write_latency_ms)==null?void 0:Oe.toFixed(1))??"N/A"," ms"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Share pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:_e!==null?`${_e.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-xs text-slate-400",children:"accept rate"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["accepted ",r(i==null?void 0:i.shares_accepted)," · rejected ",r(i==null?void 0:i.shares_rejected)]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["workers ",r(i==null?void 0:i.connected_workers)," · last share ",$((i==null?void 0:i.last_share_at)||null)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:["Block pipeline",q?` (${q})`:""]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(i==null?void 0:i.blocks_accepted)}),e.jsx("div",{className:"text-xs text-slate-400",children:"accepted by node"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["candidates ",r(ds)," · rejected ",r(is)]}),e.jsxs("div",{className:"text-xs text-slate-400 truncate",title:(i==null?void 0:i.last_block_submit_result)||"",children:["last result ",(i==null?void 0:i.last_block_submit_result)||"N/A"]})]})]}),e.jsxs("div",{className:"border-t border-slate-700/60 pt-4",children:[e.jsx("div",{className:"mb-3 text-xs uppercase tracking-wide text-slate-400",children:"Stratum DB health"}),(l==null?void 0:l.database_status)!=="ok"?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:["Unavailable: ",(l==null?void 0:l.database_error)||"No DB health response"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Connection Pool"}),e.jsx(Ve,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="critical"?"text-red-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-emerald-400"}`})]}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-xl font-semibold text-slate-100",children:[((Qe=x==null?void 0:x.utilization_percent)==null?void 0:Qe.toFixed(1))??"N/A","%"]}),e.jsx("span",{className:"text-xs text-slate-400",children:"utilized"})]}),e.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-slate-700",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${B>90?"bg-red-500":B>80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${B}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:[r(x==null?void 0:x.checked_out),"/",r(x==null?void 0:x.total_capacity)," (",r((x==null?void 0:x.max_capacity_configured)??(x==null?void 0:x.total_capacity))," max)"]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Active Queries"}),e.jsx(bs,{className:"h-4 w-4 text-blue-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:r(j==null?void 0:j.active_connections)}),e.jsxs("div",{className:"mt-1 text-xs text-slate-400",children:["Slow (>1m): ",r(j==null?void 0:j.long_running_queries)]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Database Size"}),e.jsx(ps,{className:"h-4 w-4 text-purple-400"})]}),e.jsx("div",{className:"mt-1 text-xl font-semibold text-slate-100",children:js(j==null?void 0:j.database_size_mb)}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:"total storage"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Health Status"}),e.jsx(ms,{className:`h-4 w-4 ${(a==null?void 0:a.status)==="healthy"?"text-emerald-400":(a==null?void 0:a.status)==="warning"?"text-amber-400":"text-red-400"}`})]}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-2 py-1 text-xs ${(a==null?void 0:a.status)==="healthy"?"border-emerald-700/50 bg-emerald-900/30 text-emerald-300":(a==null?void 0:a.status)==="warning"?"border-amber-700/60 bg-amber-900/30 text-amber-300":"border-red-700/60 bg-red-900/30 text-red-300"}`,children:((a==null?void 0:a.status)||"unknown").toUpperCase()})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:[(a==null?void 0:a.status)==="healthy"&&"All systems operational",(a==null?void 0:a.status)==="warning"&&"Pool usage high",(a==null?void 0:a.status)==="critical"&&"Pool nearly exhausted"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (last 24h)"}),e.jsxs("div",{className:"mb-3 text-xs text-slate-500",children:["Since ",((Be=a==null?void 0:a.high_water_marks)==null?void 0:Be.last_24h_date)||"N/A"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((Ke=p==null?void 0:p.db_pool_wait_seconds_sum)==null?void 0:Ke.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(p==null?void 0:p.slow_queries_peak)})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-slate-400",children:"High-water marks (since boot)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Pool in-use peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(g==null?void 0:g.db_pool_in_use_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Active queries peak"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(g==null?void 0:g.active_queries_peak)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait count"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(g==null?void 0:g.db_pool_wait_count)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Wait seconds"}),e.jsxs("div",{className:"font-semibold text-slate-100",children:[((ze=g==null?void 0:g.db_pool_wait_seconds_sum)==null?void 0:ze.toFixed(1))??"N/A","s"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400",children:"Slow queries"}),e.jsx("div",{className:"font-semibold text-slate-100",children:r(g==null?void 0:g.slow_queries_peak)})]})]})]})]})]})]})]})]},t.pool_id)})})]})]})}export{As as default};
