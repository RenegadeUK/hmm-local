import{c as Z,b as J,a as E,j as e,o as ee,W as se,C as i,d as x,e as m,f as o,an as te,$ as ae,ao as re,r as ne,a1 as K}from"./index-B4KL4pFw-1771540006449.js";import{A as ce}from"./alert-triangle-yqhS2KQ--1771540006449.js";import{C as le}from"./check-circle-2-Dz3CnYSl-1771540006449.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=Z("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ie=new Set(["BTC","BCH","DGB"]);function O(s){return typeof s!="number"||!Number.isFinite(s)||s<=0?"N/A":s>=1e18?`${(s/1e18).toFixed(2)} EH/s`:s>=1e15?`${(s/1e15).toFixed(2)} PH/s`:s>=1e12?`${(s/1e12).toFixed(2)} TH/s`:s>=1e9?`${(s/1e9).toFixed(2)} GH/s`:s>=1e6?`${(s/1e6).toFixed(2)} MH/s`:s>=1e3?`${(s/1e3).toFixed(2)} KH/s`:`${s.toFixed(2)} H/s`}function V(s){return typeof s!="number"||!Number.isFinite(s)?"N/A":`${s.toFixed(2)}%`}function p(s){return typeof s!="number"||!Number.isFinite(s)?"N/A":s.toLocaleString()}function oe(s){if(typeof s!="number"||!Number.isFinite(s))return"N/A";const a=Math.abs(s);return a>=1e12?`${(s/1e12).toFixed(2)}T`:a>=1e9?`${(s/1e9).toFixed(2)}B`:a>=1e6?`${(s/1e6).toFixed(2)}M`:a>=1e3?`${(s/1e3).toFixed(2)}K`:s.toFixed(2)}function xe(s){return typeof s!="number"||!Number.isFinite(s)?"N/A":Math.abs(s)>=1e3?`${(s/1e3).toFixed(2)}K`:s.toFixed(2)}function me(s){if(typeof s!="number"||!Number.isFinite(s)||s<=0)return"N/A";const a=Math.floor(s),n=Math.floor(a/3600),r=Math.floor(a%3600/60),c=a%60;return n>0?`${n}h ${r}m ${c}s`:r>0?`${r}m ${c}s`:`${c}s`}function $(s){if(!s)return"Unknown";const a=new Date(s).getTime();if(Number.isNaN(a))return s;const n=Math.max(0,Math.floor((Date.now()-a)/1e3));if(n<60)return`${n}s ago`;const r=Math.floor(n/60);if(r<60)return`${r}m ago`;const c=Math.floor(r/60);return c<24?`${c}h ago`:`${Math.floor(c/24)}d ago`}function he(s){var c;if(!s)return s;const a=s.trim();if(!a.includes("."))return a;const n=a.split(".");return((c=n[n.length-1])==null?void 0:c.trim())||a}function pe(s){if(!s)return"Unknown";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toISOString().replace("T"," ").replace(".000Z","Z")}function G(s,a=8){return s?s.length<=a*2+3?s:`${s.slice(0,a)}...${s.slice(-a)}`:"N/A"}function ue(s){if(s.accepted_by_node)return{label:"Accepted",className:"border-emerald-700/50 bg-emerald-900/30 text-emerald-300"};const a=String(s.reject_category||"").toLowerCase();return a.includes("invalid")||a.includes("bad")||a.includes("rpc_error")?{label:"Rejected",className:"border-red-700/60 bg-red-900/30 text-red-300"}:{label:"Inconclusive",className:"border-amber-700/60 bg-amber-900/30 text-amber-300"}}function C({points:s,colorClass:a}){const n=ne.useMemo(()=>{const r=s.slice(-60);if(r.length<2)return"";const c=260,f=70,h=8,l=8,j=Math.min(...r.map(d=>d.x)),F=Math.max(...r.map(d=>d.x)),u=Math.min(...r.map(d=>d.y)),b=Math.max(...r.map(d=>d.y)),N=Math.max(F-j,1),g=Math.max(b-u,1);return r.map(d=>{const y=h+(d.x-j)/N*(c-h*2),_=f-l-(d.y-u)/g*(f-l*2);return`${y},${_}`}).join(" ")},[s]);return n?e.jsx("svg",{viewBox:"0 0 260 70",className:"h-[70px] w-full",children:e.jsx("polyline",{fill:"none",strokeWidth:"2",className:a,points:n})}):e.jsx("div",{className:"h-[70px] text-xs text-slate-500 flex items-center",children:"Not enough points"})}function Ne(){var u,b,N,g,d,y,_,S,H,A,M,T,k,B,D,L,R,U,P;const a=(J().coin||"").toUpperCase(),n=!ie.has(a),{data:r,isLoading:c,isError:f,error:h}=E({queryKey:["stratum-dashboard",a],queryFn:()=>K.getHmmLocalStratumCoinDashboard(a),enabled:!n,refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3}),l=E({queryKey:["stratum-dashboard",a,"candidate-incidents"],queryFn:()=>K.getHmmLocalStratumCandidateIncidents(24,30,a),enabled:!n,refetchInterval:3e4,refetchOnWindowFocus:!1,staleTime:25e3});if(n)return e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-4 text-amber-200",children:"Unsupported coin route. Use BTC, BCH or DGB."});if(c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ee,{className:"h-8 w-8 animate-spin text-blue-500"})});if(f||!r)return e.jsxs("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:["Failed to load Stratum dashboard data: ",(h==null?void 0:h.message)||"Unknown error"]});const j=((u=r.quality)==null?void 0:u.readiness)||"unknown",F=!!((b=r.quality)!=null&&b.stale);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-3xl font-semibold text-foreground",children:[e.jsx(se,{className:"h-8 w-8 text-blue-400"}),e.jsxs("span",{children:["HMM-Local Stratum · ",a]})]}),e.jsxs("p",{className:"text-base text-muted-foreground",children:["Pool and miner telemetry for ",a," from local Stratum datastore."]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Readiness"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-semibold capitalize",children:j}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:F?"Data stale":"Data fresh"})]})]}),e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Pool hashrate"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-semibold",children:O((N=r.hashrate)==null?void 0:N.pool_hashrate_hs)}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Workers: ",r.workers.count]})]})]}),e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Share reject rate"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-semibold",children:V(((g=r.kpi)==null?void 0:g.share_reject_rate_pct)??null)}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Accepted ",p(((d=r.kpi)==null?void 0:d.share_accept_count)??null)," · Rejected ",p(((y=r.kpi)==null?void 0:y.share_reject_count)??null)]})]})]}),e.jsxs(i,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm text-muted-foreground",children:"Blocks (24h)"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-semibold",children:p(((_=r.kpi)==null?void 0:_.block_accept_count_24h)??null)}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Rejected ",p(((S=r.kpi)==null?void 0:S.block_reject_count_24h)??null)," · ETA ",me(((H=r.kpi)==null?void 0:H.expected_time_to_block_sec)??null)]})]})]})]}),e.jsxs(i,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2 text-base",children:[e.jsx(te,{className:"h-4 w-4"})," Pool hashrate trend"]})}),e.jsx(o,{children:e.jsx(C,{points:r.charts.pool_hashrate_hs||[],colorClass:"stroke-blue-400"})})]}),e.jsxs(i,{children:[e.jsx(x,{children:e.jsx(m,{className:"text-base",children:"Candidate incidents (24h)"})}),e.jsx(o,{className:"space-y-4",children:l.isLoading?e.jsx("div",{className:"text-sm text-slate-300",children:"Loading candidate incidents…"}):l.isError?e.jsxs("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-sm text-amber-300",children:["Failed to load candidate incidents: ",((A=l.error)==null?void 0:A.message)||"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Accepted: ",((M=l.data)==null?void 0:M.summary.accepted)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rejected: ",((T=l.data)==null?void 0:T.summary.rejected)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-300",children:["Rows: ",((k=l.data)==null?void 0:k.count)??0]}),e.jsxs("span",{className:"inline-flex rounded-full border border-slate-700/60 bg-slate-900/40 px-2 py-1 text-slate-400",children:["Updated ",$(((B=l.data)==null?void 0:B.fetched_at)||null)]})]}),(((L=(D=l.data)==null?void 0:D.fetch_errors)==null?void 0:L.length)||0)>0&&e.jsx("div",{className:"rounded-lg border border-amber-700/60 bg-amber-900/30 p-3 text-xs text-amber-300",children:"Some Stratum endpoints were unavailable. Showing partial results."}),(((U=(R=l.data)==null?void 0:R.rows)==null?void 0:U.length)||0)===0?e.jsxs("div",{className:"rounded-lg border border-slate-700/60 bg-slate-900/40 p-4 text-sm text-slate-300",children:["No candidate incidents in the last 24 hours for ",a,"."]}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-slate-700/60",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-slate-900/60 text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 font-medium",children:"Time (UTC)"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Worker"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Job"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Template"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Block"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Result"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Category"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Latency"}),e.jsx("th",{className:"px-3 py-2 font-medium",children:"Variant"})]})}),e.jsx("tbody",{children:(((P=l.data)==null?void 0:P.rows)||[]).map(t=>{const w=ue(t);return e.jsxs("tr",{className:"border-t border-slate-800/70 text-slate-200",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:pe(t.ts)}),e.jsx("td",{className:"px-3 py-2",title:t.worker||"",children:G(t.worker,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.job_id||"N/A"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.template_height??"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.block_hash||"",children:G(t.block_hash,10)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex rounded-full border px-2 py-1 ${w.className}`,children:w.label})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.reject_category||"accepted"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:typeof t.latency_ms=="number"?`${t.latency_ms.toFixed(2)} ms`:"N/A"}),e.jsx("td",{className:"px-3 py-2",title:t.matched_variant||"",children:t.matched_variant||"N/A"})]},`${t.ts}-${t.job_id||"no-job"}`)})})]})})]})})]}),e.jsx("div",{className:"space-y-4",children:r.workers.rows.length===0?e.jsx(i,{children:e.jsx(o,{className:"py-6 text-sm text-muted-foreground",children:"No worker rows available yet for this coin."})}):r.workers.rows.map(t=>e.jsx(i,{children:(()=>{var W;const w=typeof t.current_hashrate_hs=="number"&&Number.isFinite(t.current_hashrate_hs)&&t.current_hashrate_hs>0,X=typeof t.accepted=="number"&&typeof t.rejected=="number"&&Number.isFinite(t.accepted)&&Number.isFinite(t.rejected)&&t.accepted+t.rejected>0,I=typeof t.reject_rate_pct=="number"&&Number.isFinite(t.reject_rate_pct),Y=typeof t.highest_diff=="number"&&Number.isFinite(t.highest_diff),z=!!t.last_share_at,q=(t.hashrate_chart||[]).length>=2,v=(t.vardiff_chart||[]).length>=2,Q=v?(W=t.vardiff_chart[t.vardiff_chart.length-1])==null?void 0:W.y:null;return e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(m,{className:"text-base",children:he(t.worker)}),e.jsx("div",{className:"flex items-center gap-2 text-xs",children:I&&t.reject_rate_pct!==null&&t.reject_rate_pct>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-red-700/60 bg-red-900/30 px-2 py-1 text-red-300",children:[e.jsx(ce,{className:"h-3 w-3"})," High reject risk"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-700/50 bg-emerald-900/30 px-2 py-1 text-emerald-300",children:[e.jsx(le,{className:"h-3 w-3"})," Active"]})})]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-5",children:[w&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Current hashrate"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:O(t.current_hashrate_hs)})]}),X&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Shares"}),e.jsxs("div",{className:"mt-1 text-sm text-slate-100",children:[p(t.accepted)," accepted"]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[p(t.rejected)," rejected"]})]}),I&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Reject rate"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:V(t.reject_rate_pct)})]}),Y&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Highest diff"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:oe(t.highest_diff)})]}),z&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Last share"}),e.jsx("div",{className:"mt-1 text-sm text-slate-100",children:$(t.last_share_at)})]})]}),(q||v)&&e.jsxs("div",{className:"grid gap-4 xl:grid-cols-2",children:[q&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-xs uppercase tracking-wide text-slate-400",children:[e.jsx(ae,{className:"h-3.5 w-3.5"})," Hashrate trend"]}),e.jsx(C,{points:t.hashrate_chart||[],colorClass:"stroke-cyan-400"})]}),v&&e.jsxs("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/30 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-xs uppercase tracking-wide text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-3.5 w-3.5"})," Vardiff trend"]}),e.jsxs("div",{className:"text-[11px] normal-case text-slate-300",children:["Current: ",xe(Q)]})]}),e.jsx(C,{points:t.vardiff_chart||[],colorClass:"stroke-purple-400"})]})]})]})]})})()},t.worker))}),e.jsx("div",{className:"rounded-lg border border-slate-700/50 bg-slate-900/20 p-3 text-xs text-slate-400",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(re,{className:"h-3.5 w-3.5"})," Pool: ",r.pool.name]}),e.jsxs("span",{children:["Source: ",r.api_base]}),e.jsxs("span",{children:["Updated: ",$(r.fetched_at)]})]})})]})}export{Ne as default};
