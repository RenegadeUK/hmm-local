import{c as _,a as f,j as e,m as g,Y as v,A as b,a0 as n}from"./index-BHhiGcm1.js";import{L as w}from"./layers-MtbOITFg.js";import{S as k}from"./shield-alert-2AyECuAO.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=_("ServerCog",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M4.5 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-.5",key:"tn8das"}],["path",{d:"M4.5 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-.5",key:"1g2pve"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m15.7 13.4-.9-.3",key:"1jwmzr"}],["path",{d:"m9.2 10.9-.9-.3",key:"qapnim"}],["path",{d:"m10.6 15.7.3-.9",key:"quwk0k"}],["path",{d:"m13.6 15.7-.4-1",key:"cb9xp7"}],["path",{d:"m10.8 9.3-.4-1",key:"1uaiz5"}],["path",{d:"m8.3 13.6 1-.4",key:"s6srou"}],["path",{d:"m14.7 10.8 1-.4",key:"4d31cq"}],["path",{d:"m13.4 8.3-.3.9",key:"1bm987"}]]);function H(){var m;const{data:o,isLoading:p,isError:y}=f({queryKey:["operations-status"],queryFn:async()=>{const t=await fetch("/api/operations/status");if(!t.ok)throw new Error("Failed to load operations status");return t.json()},refetchInterval:5e3});if(p)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-blue-500"})});if(y||!o)return e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load operations status."});const{automation_rules:x,strategy:l,ha:d,telemetry:a,db_pool:r,modes:s}=o,i=({values:t,labels:h,color:u="bg-blue-500"})=>{const j=Math.max(...t,1);return e.jsx("div",{className:"flex items-end gap-2",children:t.map((N,c)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-3 rounded-full ${u}`,style:{height:`${N/j*36+6}px`}}),e.jsx("span",{className:"text-[10px] text-gray-400",children:h[c]})]},`${h[c]}-${c}`))})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-gray-800 bg-gradient-to-r from-blue-950/60 via-slate-900/80 to-gray-900/60 p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-7 w-7 text-blue-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Operations"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real-time system posture & decision trace"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.ramp_up?"bg-yellow-900/40 text-yellow-300 border border-yellow-700/60":"bg-emerald-900/30 text-emerald-300 border border-emerald-700/40"}`,children:s.ramp_up?"Ramp-up":"Stable"}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.throttling_writes?"bg-red-900/40 text-red-300 border border-red-700/60":"bg-slate-800/60 text-slate-300 border border-slate-700/40"}`,children:s.throttling_writes?"Write Throttling":"Writes OK"}),e.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.ha_unstable?"bg-orange-900/40 text-orange-300 border border-orange-700/60":"bg-slate-800/60 text-slate-300 border border-slate-700/40"}`,children:s.ha_unstable?"HA Degraded":"HA Stable"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-blue-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Active automation rules"}),e.jsx(w,{className:"h-4 w-4 text-blue-400"})]}),x.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No active rules."}):e.jsx("ul",{className:"space-y-2 text-sm",children:x.map(t=>e.jsxs("li",{className:"rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("div",{className:"text-white font-semibold",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Trigger: ",t.trigger_type," • Action: ",t.action_type]})]},t.id))})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-purple-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Current strategy per miner"}),e.jsx(v,{className:"h-4 w-4 text-purple-400"})]}),l.enrolled_miners.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No miners enrolled."}):e.jsx("ul",{className:"space-y-2 text-sm",children:l.enrolled_miners.map(t=>e.jsxs("li",{className:"flex items-center justify-between rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("span",{className:"text-white",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400",children:"Agile Solo"})]},t.id))})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800 shadow-lg shadow-emerald-500/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Last decision"}),e.jsx(g,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"text-white",children:["Band: ",l.current_price_band??"N/A"]}),e.jsxs("div",{className:"text-gray-400",children:["Last action: ",l.last_action_time??"N/A"]}),e.jsxs("div",{className:"text-gray-400",children:["Last price: ",l.last_price_checked??"N/A"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`rounded-xl border p-4 ${s.ramp_up?"border-yellow-700 bg-yellow-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:`h-4 w-4 ${s.ramp_up?"text-yellow-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"System ramp-up"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:s.ramp_up?"Telemetry backlog detected; system may be catching up.":"Normal telemetry cadence."})]}),e.jsxs("div",{className:`rounded-xl border p-4 ${s.throttling_writes?"border-red-700 bg-red-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:`h-4 w-4 ${s.throttling_writes?"text-red-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Write throttling"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:s.throttling_writes?"DB pool usage is high; writes may be constrained.":"DB pool healthy."})]}),e.jsxs("div",{className:`rounded-xl border p-4 ${s.ha_unstable?"border-orange-700 bg-orange-900/20":"border-gray-700 bg-gray-900/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:`h-4 w-4 ${s.ha_unstable?"text-orange-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"HA unstable"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:s.ha_unstable?"Home Assistant keepalive is unstable.":"Home Assistant stable."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"DB connections"}),e.jsx(n,{className:"h-4 w-4 text-blue-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:r.high_water.last_24h.db_pool_in_use_peak}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • since ",r.high_water.last_24h_date]})]}),e.jsx(i,{values:[r.checked_out,r.high_water.last_24h.db_pool_in_use_peak,r.high_water.since_boot.db_pool_in_use_peak],labels:["Now","24h","Boot"],color:"bg-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Miner concurrency"}),e.jsx(n,{className:"h-4 w-4 text-purple-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.last_24h.peak_concurrency}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • since ",a.metrics.last_24h_date]})]}),e.jsx(i,{values:[a.metrics.last_24h.peak_concurrency,a.metrics.since_boot.peak_concurrency],labels:["24h","Boot"],color:"bg-purple-500"})]})]}),e.jsxs("div",{className:"bg-gray-900/80 rounded-xl p-5 border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Telemetry backlog"}),e.jsx(n,{className:"h-4 w-4 text-emerald-400"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.last_24h.max_backlog}),e.jsxs("p",{className:"text-xs text-gray-500",children:["24h peak • current ",a.backlog_current]})]}),e.jsx(i,{values:[a.backlog_current,a.metrics.last_24h.max_backlog,a.metrics.since_boot.max_backlog],labels:["Now","24h","Boot"],color:"bg-emerald-500"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/70 rounded-xl p-4 border border-gray-800",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"DB connections (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:r.high_water.since_boot.db_pool_in_use_peak})]}),e.jsxs("div",{className:"bg-gray-900/70 rounded-xl p-4 border border-gray-800",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"Miner concurrency (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:a.metrics.since_boot.peak_concurrency})]}),e.jsxs("div",{className:"bg-gray-900/70 rounded-xl p-4 border border-gray-800",children:[e.jsx("h3",{className:"text-xs font-medium text-gray-400 mb-1",children:"Telemetry backlog (since boot)"}),e.jsx("div",{className:"text-xl font-bold text-white",children:a.metrics.since_boot.max_backlog})]})]}),((m=d.detail)==null?void 0:m.enabled)&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 text-xs text-gray-500",children:["HA last success: ",d.detail.last_success??"N/A"," · Downtime start: ",d.detail.downtime_start??"N/A"," · Alerts: ",d.detail.alerts_sent??0]})]})}export{H as default};
