const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-WbqcsJds-1770639470295.js","assets/index-CoYtvV0b-1770639470295.js","assets/index-BMm9JogE.css","assets/chart-CRw1OhKu-1770639470295.js","assets/chartjs-plugin-annotation.esm-eXReptW6-1770639470295.js","assets/chartjs-adapter-date-fns.esm-C0oLDNpm-1770639470295.js"])))=>i.map(i=>d[i]);
import{c as L,r as u,a2 as N,a as R,j as e,a3 as O,C as p,d as A,e as P,s as G,t as q,v as U,w as z,x as H,B as J,R as K,f as x,o as Y,Y as Q}from"./index-CoYtvV0b-1770639470295.js";import{L as D}from"./loader-2-wn6oATgf-1770639470295.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=L("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=L("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);async function M(r,i){const a=await fetch(r,{headers:{"Content-Type":"application/json"},...i});if(!a.ok){const n=await a.json().catch(()=>({})),t=n.detail||n.message||`Request failed (${a.status})`;throw new Error(t)}if(a.status!==204)return a.json()}const se=[{value:"3",label:"3 days"},{value:"5",label:"5 days"},{value:"7",label:"7 days"}];function v(r){var g;if(!r)return"—";const i=new Date(r.start),a=i.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),n=i.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"});return`${((g=r.price_pred_pence)==null?void 0:g.toFixed(2))??"—"} p/kWh • ${n} ${a}`}function te(r){return r?new Date(r).toLocaleString("en-GB",{weekday:"short",hour:"2-digit",minute:"2-digit",day:"numeric",month:"short"}):"—"}function re(r){const i=r.map(n=>n.price_pred_pence).filter(n=>typeof n=="number");if(!i.length)return null;const a=i.reduce((n,t)=>n+t,0);return Number((a/i.length).toFixed(2))}function ie(){const[r,i]=u.useState(null);u.useEffect(()=>{console.log("[AgilePredict] Starting dynamic Chart.js import..."),Promise.all([N(()=>import("./index-WbqcsJds-1770639470295.js"),__vite__mapDeps([0,1,2,3])),N(()=>import("./chart-CRw1OhKu-1770639470295.js").then(s=>s.V),[]),N(()=>import("./chartjs-plugin-annotation.esm-eXReptW6-1770639470295.js"),__vite__mapDeps([4,3])),N(()=>import("./chartjs-adapter-date-fns.esm-C0oLDNpm-1770639470295.js"),__vite__mapDeps([5,3]))]).then(([s,c,l])=>{console.log("[AgilePredict] Chart.js imports complete, registering...");const{Chart:b,CategoryScale:o,LinearScale:m,PointElement:I,LineElement:T,Title:B,Tooltip:$,Legend:V,TimeScale:W}=c;b.register(o,m,I,T,B,$,V,W),console.log("[AgilePredict] Chart.js registration complete"),i({Line:s.Line,ChartJS:b,annotationPlugin:l.default})}).catch(s=>{console.error("[AgilePredict] Failed to load Chart.js:",s)})},[]);const[a,n]=u.useState("7"),{data:t,isLoading:g,isFetching:S,error:_,refetch:E}=R({queryKey:["agile-forecast",a],queryFn:()=>M(`/api/energy/agile-forecast?days=${a}`),refetchInterval:3e5}),{data:w}=R({queryKey:["agile-bands"],queryFn:()=>M("/api/settings/agile-solo-strategy/bands"),refetchInterval:3e5}),d=w==null?void 0:w.bands.find(s=>s.sort_order===5),f=typeof(d==null?void 0:d.min_price)=="number"?d.min_price:19,j=typeof(d==null?void 0:d.max_price)=="number"?d.max_price:30,y=u.useMemo(()=>{var s;return(s=t==null?void 0:t.days)!=null&&s.length?t.days.flatMap(c=>c.slots.filter(l=>typeof l.price_pred_pence=="number").map(l=>({timestamp:l.start,price:l.price_pred_pence}))):[]},[t]),k=u.useMemo(()=>y.length?{labels:y.map(s=>new Date(s.timestamp)),datasets:[{label:"Predicted price",data:y.map(s=>s.price),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.35,pointRadius:0}]}:null,[y]),F=u.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>{var l;return`${(typeof((l=s.parsed)==null?void 0:l.y)=="number"?s.parsed.y:0).toFixed(2)} p/kWh`}}},annotation:{annotations:{line19p:{type:"line",yMin:Number(f),yMax:Number(f),borderColor:"rgba(234, 179, 8, 0.7)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`Band 5 Min: ${Number(f).toFixed(1)}p/kWh`,position:"end",backgroundColor:"rgba(234, 179, 8, 0.2)",color:"rgba(234, 179, 8, 1)",font:{size:11},padding:4}},line30p:{type:"line",yMin:Number(j),yMax:Number(j),borderColor:"rgba(239, 68, 68, 0.7)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`Band 5 Max: ${Number(j).toFixed(1)}p/kWh`,position:"end",backgroundColor:"rgba(239, 68, 68, 0.2)",color:"rgba(239, 68, 68, 1)",font:{size:11},padding:4}}}}},scales:{x:{type:"time",time:{unit:"hour"},ticks:{maxRotation:0},grid:{color:"rgba(255,255,255,0.05)"}},y:{beginAtZero:!1,title:{display:!0,text:"p/kWh"},grid:{color:"rgba(255,255,255,0.05)"}}}}),[f,j]),C=(t==null?void 0:t.days)??[],h=t==null?void 0:t.summary;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{children:"Agile Predict"})]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"7-Day Agile Forecast"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Ingested directly from AgilePredict.com with daily refresh windows at 04:30. Use the forecast to pre-stage automation rules, power plans, and miner bands."})]}),e.jsxs(p,{children:[e.jsxs(A,{className:"flex flex-col gap-4 border-b border-border/50 bg-muted/10 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-blue-300",children:"Forecast Controls"}),e.jsxs(P,{className:"text-xl",children:["Region ",(t==null?void 0:t.region)??"—"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated ",te(t==null?void 0:t.forecast_created_at)]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(G,{value:a,onValueChange:n,children:[e.jsx(q,{className:"w-full sm:w-32",children:e.jsx(U,{placeholder:"Days"})}),e.jsx(z,{children:se.map(s=>e.jsx(H,{value:s.value,children:s.label},s.value))})]}),e.jsxs(J,{onClick:()=>E(),variant:"secondary",disabled:S,className:"gap-2",children:[S?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"}),"Refresh"]})]})]}),e.jsxs(x,{className:"py-6",children:[_&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:_ instanceof Error?_.message:"Unable to load Agile Predict forecast."})]}),g?e.jsxs("div",{className:"flex items-center gap-3 text-muted-foreground",children:[e.jsx(D,{className:"h-4 w-4 animate-spin"}),"Loading forecast…"]}):null]})]}),h&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(p,{children:e.jsxs(x,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Average price"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold",children:h.average_price_pence?`${h.average_price_pence.toFixed(2)} p/kWh`:"—"})]})}),e.jsx(p,{children:e.jsxs(x,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total slots"}),e.jsx("p",{className:"mt-2 text-3xl font-semibold",children:h.slot_count})]})}),e.jsx(p,{children:e.jsxs(x,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Cheapest slot"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:v(h.cheapest_slot)})]})}),e.jsx(p,{children:e.jsxs(x,{className:"p-5",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Most expensive"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:v(h.most_expensive_slot)})]})})]}),k&&e.jsxs(p,{children:[e.jsxs(A,{children:[e.jsx(P,{children:"Price trajectory"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Predicted half-hour slots over the selected window."})]}),e.jsx(x,{children:e.jsx("div",{className:"h-80",children:r?e.jsx(r.Line,{data:k,options:F,plugins:[r.annotationPlugin],"aria-label":"Agile forecast chart"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})})]}),k&&C.length>0&&e.jsx("div",{className:"rounded-md border border-border/40 bg-muted/5 p-4",children:e.jsx("div",{className:"flex divide-x divide-border/30",children:C.map(s=>{const c=new Date(s.date).toLocaleDateString("en-GB",{weekday:"long"});return e.jsxs("div",{className:"flex-1 px-3 text-center text-sm",children:[e.jsx("div",{className:"mb-2 h-4 w-px bg-blue-500/70 mx-auto"}),e.jsx("p",{className:"font-medium text-gray-200",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.date).toLocaleDateString("en-GB",{day:"numeric",month:"short"})})]},s.date)})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm uppercase tracking-widest text-blue-300",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Daily breakdown"})]}),e.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:C.map(s=>{const c=re(s.slots),l=[...s.slots].sort((o,m)=>(o.price_pred_pence??1/0)-(m.price_pred_pence??1/0))[0],b=[...s.slots].sort((o,m)=>(m.price_pred_pence??-1/0)-(o.price_pred_pence??-1/0))[0];return e.jsxs(p,{className:"border-border/60",children:[e.jsxs(A,{children:[e.jsx(P,{className:"text-lg",children:new Date(s.date).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Average ",c?`${c.toFixed(2)} p/kWh`:"—"]})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border border-emerald-500/40 bg-emerald-500/5 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-300",children:[e.jsx(Z,{className:"h-4 w-4"}),"Cheapest"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:v(l)})]}),e.jsxs("div",{className:"rounded-md border border-rose-500/40 bg-rose-500/5 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-rose-300",children:[e.jsx(X,{className:"h-4 w-4"}),"Expensive"]}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:v(b)})]})]}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:s.slots.slice(0,8).map(o=>{var m;return e.jsxs("div",{className:Q("flex items-center justify-between rounded-md border px-3 py-2 text-sm",(o.price_pred_pence??0)<=(c??0)?"border-emerald-500/40 bg-emerald-500/5":"border-amber-500/40 bg-amber-500/5"),children:[e.jsx("span",{children:new Date(o.start).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}),e.jsxs("span",{className:"font-medium",children:[(m=o.price_pred_pence)==null?void 0:m.toFixed(2),"p"]})]},o.start)})}),s.slots.length>8&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",s.slots.length-8," more half-hour slots"]})]})]},s.date)})})]})]})}export{ie as default};
