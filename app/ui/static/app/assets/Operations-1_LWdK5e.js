import{c as g,a as y,j as e,m,Y as b,A as o}from"./index-BNZl1TmN.js";import{L as p}from"./layers-CEOHe6OE.js";import{S as u}from"./shield-alert-Dy_SYKbP.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=g("ServerCog",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M4.5 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-.5",key:"tn8das"}],["path",{d:"M4.5 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-.5",key:"1g2pve"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m15.7 13.4-.9-.3",key:"1jwmzr"}],["path",{d:"m9.2 10.9-.9-.3",key:"qapnim"}],["path",{d:"m10.6 15.7.3-.9",key:"quwk0k"}],["path",{d:"m13.6 15.7-.4-1",key:"cb9xp7"}],["path",{d:"m10.8 9.3-.4-1",key:"1uaiz5"}],["path",{d:"m8.3 13.6 1-.4",key:"s6srou"}],["path",{d:"m14.7 10.8 1-.4",key:"4d31cq"}],["path",{d:"m13.4 8.3-.3.9",key:"1bm987"}]]);function f(){var n;const{data:i,isLoading:x,isError:h}=y({queryKey:["operations-status"],queryFn:async()=>{const s=await fetch("/api/operations/status");if(!s.ok)throw new Error("Failed to load operations status");return s.json()},refetchInterval:5e3});if(x)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-blue-500"})});if(h||!i)return e.jsx("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4 text-red-200",children:"Failed to load operations status."});const{automation_rules:c,strategy:r,ha:d,telemetry:a,db_pool:l,modes:t}=i;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Operations"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Active automation rules"}),e.jsx(p,{className:"h-4 w-4 text-blue-400"})]}),c.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No active rules."}):e.jsx("ul",{className:"space-y-2 text-sm",children:c.map(s=>e.jsxs("li",{className:"rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("div",{className:"text-white font-semibold",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Trigger: ",s.trigger_type," • Action: ",s.action_type]})]},s.id))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Current strategy per miner"}),e.jsx(b,{className:"h-4 w-4 text-purple-400"})]}),r.enrolled_miners.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No miners enrolled."}):e.jsx("ul",{className:"space-y-2 text-sm",children:r.enrolled_miners.map(s=>e.jsxs("li",{className:"flex items-center justify-between rounded-md border border-gray-700 bg-gray-900/50 p-2",children:[e.jsx("span",{className:"text-white",children:s.name}),e.jsx("span",{className:"text-xs text-gray-400",children:"Agile Solo"})]},s.id))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Last decision"}),e.jsx(m,{className:"h-4 w-4 text-green-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"text-white",children:["Band: ",r.current_price_band??"N/A"]}),e.jsxs("div",{className:"text-gray-400",children:["Last action: ",r.last_action_time??"N/A"]}),e.jsxs("div",{className:"text-gray-400",children:["Last price: ",r.last_price_checked??"N/A"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`rounded-lg border p-4 ${t.ramp_up?"border-yellow-700 bg-yellow-900/20":"border-gray-700 bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:`h-4 w-4 ${t.ramp_up?"text-yellow-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"System ramp-up"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t.ramp_up?"Telemetry backlog detected; system may be catching up.":"Normal telemetry cadence."})]}),e.jsxs("div",{className:`rounded-lg border p-4 ${t.throttling_writes?"border-red-700 bg-red-900/20":"border-gray-700 bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:`h-4 w-4 ${t.throttling_writes?"text-red-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Write throttling"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t.throttling_writes?"DB pool usage is high; writes may be constrained.":"DB pool healthy."})]}),e.jsxs("div",{className:`rounded-lg border p-4 ${t.ha_unstable?"border-orange-700 bg-orange-900/20":"border-gray-700 bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:`h-4 w-4 ${t.ha_unstable?"text-orange-400":"text-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"HA unstable"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t.ha_unstable?"Home Assistant keepalive is unstable.":"Home Assistant stable."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Peak DB connections (24h)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.high_water.last_24h.db_pool_in_use_peak}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["since ",l.high_water.last_24h_date]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Peak miner concurrency (24h)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.last_24h.peak_concurrency}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["since ",a.metrics.last_24h_date]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Max telemetry backlog (24h)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.last_24h.max_backlog}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["current: ",a.backlog_current]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Peak DB connections (since boot)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.high_water.since_boot.db_pool_in_use_peak})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Peak miner concurrency (since boot)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.since_boot.peak_concurrency})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Max telemetry backlog (since boot)"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a.metrics.since_boot.max_backlog})]})]}),((n=d.detail)==null?void 0:n.enabled)&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 text-xs text-gray-500",children:["HA last success: ",d.detail.last_success??"N/A"," · Downtime start: ",d.detail.downtime_start??"N/A"," · Alerts: ",d.detail.alerts_sent??0]})]})}export{f as default};
